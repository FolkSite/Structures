function rapidImageChangeUploadPath(e){function t(){var t=function(t,o){"ok"==t&&o&&(e.settings.tbRapidImageSettings.uploadUrl=o)};Ext.MessageBox.prompt("UPLOAD URL","<span style=text-align:center;>Changes won't affect newly added editors<br><br><b>SCRIPT</b>&nbsp;&nbsp;"+window["tinyBlocksUploadScriptUrl_"+e.id]+"</span><br><br><b>PATH</b><br>&nbsp;&nbsp;<b>Original</b>&nbsp;&nbsp;"+window["tinyBlocksUploadPath_"+e.id]+"<br>&nbsp;&nbsp;<b>Current</b>&nbsp;&nbsp;"+e.settings.tbRapidImageSettings.uploadPath+"<br><br><b>URL</b><br>&nbsp;&nbsp;<b>Original:</b>&nbsp;&nbsp;"+window["tinyBlocksUploadUrl_"+e.id]+"<br>&nbsp;&nbsp;<b>Current</b>&nbsp;&nbsp;"+e.settings.tbRapidImageSettings.uploadUrl+"<br><br><span style=text-align:center;><b>ENTER NEW <u>URL</u></b> (web address of Path)</span>",t)}if(e.getParam("tbRapidImageSettings",{}).uploadScriptUrl&&e.getParam("tbRapidImageSettings",{}).uploadPath&&e.getParam("tbRapidImageSettings",{}).uploadUrl){var o=function(o,n){"ok"==o&&n&&(e.settings.tbRapidImageSettings.uploadPath=n,t())};Ext.MessageBox.prompt("UPLOAD PATH","<span style=text-align:center;>Changes won't affect newly added editors<br><br><b>SCRIPT</b>&nbsp;&nbsp;"+window["tinyBlocksUploadScriptUrl_"+e.id]+"</span><br><b>PATH</b><br>&nbsp;&nbsp;<b>Original</b>&nbsp;&nbsp;"+window["tinyBlocksUploadPath_"+e.id]+"<br>&nbsp;&nbsp;<b>Current</b>&nbsp;&nbsp;"+e.settings.tbRapidImageSettings.uploadPath+"<br><br><b>URL</b><br>&nbsp;&nbsp;<b>Original:</b>&nbsp;&nbsp;"+window["tinyBlocksUploadUrl_"+e.id]+"<br>&nbsp;&nbsp;<b>Current</b>&nbsp;&nbsp;"+e.settings.tbRapidImageSettings.uploadUrl+"<br><br><span style=text-align:center;><b>ENTER NEW <u>PATH</u></b> (<i>relative</i> to Script)</span>",o)}else Ext.MessageBox.alert("Alert!","Please check your TinyMCE init tbRapidImageSettings")}function tinymceBubbleBarAllowMulti(e){return e.getParam("toolbar1")&&e.getParam("toolbar2")&&0!==e.getParam("bubbleBarSettings",{}).activateMultiBars?!0:!1}function tinymceBubbleBarCSSInit(e){var t=".mce-bubbleBar{position:absolute!important;z-index:999;visibility:hidden}.mce-bubbleBar.mce-tbActiveBar{padding:1px;visibility:visible;animation:tinyBubble-pop-upwards 180ms forwards linear;border-radius:0;border-width:2px!important;border-style:solid}.mce-bubbleBar.mce-bubbleBarSticky{visibility:visible!important;opacity:1!important}.mce-tbActiveBar:after{left:50%;border-style:solid;content:'';height:0;width:0;position:absolute;pointer-events:none;border-color:transparent;border-width:9px;margin-left:-9px}.mce-tbActiveBar.bbBottomArrow:after,.mce-tbActiveBar.bbBottomArrowLeft:after{top:100%;border-top-color:inherit;content:' '}.mce-tbActiveBar.bbTopArrow:after{content:' ';border-bottom-color:inherit;bottom:100%}.mce-tbActiveBar.bbBottomArrowLeft:after{left:10px}@keyframes tinyBubble-pop-upwards{0%{opacity:0;transform:matrix(.97,0,0,1,0,12)}20%{opacity:.7;transform:matrix(.99,0,0,1,0,2)}40%{opacity:1;transform:matrix(1,0,0,1,0,-1)}100%{transform:matrix(1,0,0,1,0,0)}}.mce-bubbleBar .mce-container{margin:0!important;padding:0}.mce-bubbleBar>.mce-container{border-width:0!important;padding-bottom:1px}.mce-bubbleBar .mce-container:last-of-type{padding-bottom:0!important}.mce-bubbleBar>.mce-container :not(.mce-toolbar){width:inherit!important;height:inherit!important}.mce-bubbleBar .mce-btn{border:0}.mce-bubbleBar .mce-menubar{width:auto!important}";$("#tinymceBubbleBarCSS").length||e.getParam("bubbleBarSettings",{}).useCustomCSS||$("head").append('<style id="tinymceBubbleBarCSS">'+t+"</style>"),e.inline||$(e.getBody()).parents("html").find("head #tinymceBubbleBarCSS").length||""===t||$(e.getBody()).parents("html").find("head").append('<style id="tinymceBubbleBarCSS">'+t+"</style>")}function tinymceBubbleBarPosition(e){var t=e.selection.getRng(!0),o=t.getBoundingClientRect(),n=(o.left+o.right)/2,a=$(window).innerWidth(),i=($(window).height(),document.body.scrollTop||document.documentElement.scrollTop),r=15,c=e.getParam("bubbleBarSettings",{}).barsForNewLine?e.getParam("bubbleBarSettings",{}).barsForNewLine:"toolbar2",d="toolbar1",s=1,l=d,m=c,p="normal",u=$(e.getParam("fixed_toolbar_container"));0===t.getBoundingClientRect().top&&0===t.getBoundingClientRect().width&&(l=c,m=d,s=0,p="returnKey"),e.inline||(u=$(e.getContainer()).find(".mce-toolbar-grp"));var g=u.outerHeight(),h=u.outerWidth(),b=h/2,w=0,f=0,x=0,C=w-b;if(tinymceBubbleBarAllowMulti(e)){var v=u.find(".mce-tinymce-inline:visible .mce-menubar[role=menubar]"),y=u.find(".mce-tinymce-inline:visible .mce-toolbar-grp");v.length&&(s&&e.inline?(y.css("top",v.outerHeight()),f=v.outerWidth(!0),x=v.outerHeight(!0)):(v.addClass("bubbleHide"),y.css("top",function(e,t){return parseInt(t)==parseInt(v.outerHeight())?parseInt(t)-parseInt(v.outerHeight()):void 0})));var M=m.split(",");$.each(M,function(e,t){var o="hide",n=t.slice(-1)-1;u.find(".mce-container-body:visible .mce-toolbar[role=toolbar]:eq("+n+")").attr("bb-set",o).attr("bb-id",n)});var k=l.split(",");$.each(k,function(e,t){var o="show",n=t.slice(-1)-1;u.find(".mce-container-body:visible .mce-toolbar[role=toolbar]:eq("+n+")").attr("bb-set",o).attr("bb-id",n)}),"normal"==p?u.find(".mce-container-body:visible .mce-toolbar[role=toolbar]:not([bb-id])").attr("bb-set","show"):u.find(".mce-container-body:visible .mce-toolbar[role=toolbar]:not([bb-id])").removeAttr("bb-set"),u.find(".mce-container-body:visible .mce-toolbar[role=toolbar]").hide(),$("[bb-set=show]").show();var E,S,T=x;e.inline?(E=Math.max.apply(null,$("[bb-set=show]").css("display","inline-block").map(function(){return $(this).outerWidth(!0)}).get()),$("[bb-set=show]").css("display","block")):E=Math.max.apply(null,$("[bb-set=show] .mce-btn-group").parent().map(function(){return $(this).outerWidth(!0)}).get()),S=f>E?f:E,u.find("[bb-set=show]").each(function(){T+=parseInt($(this).outerHeight(!0))}),e.inline?u.children(".mce-tinymce-inline:visible").css({width:S,height:T}):u.find("[bb-set=show]").parent().css({width:S+2,height:T-3,overflow:"hidden"}),g=u.outerHeight(),h=u.outerWidth(),b=h/2,w=0,C=w-b}u.removeClass("bbTopArrow bbBottomArrowLeft").addClass("bbBottomArrow");var B,P;if(e.inline?(B=o.top+window.pageYOffset-g-r,o.top<u.height()&&(B=o.top+o.height+window.pageYOffset+r,u.removeClass("bbBottomArrow bbBottomArrowLeft").addClass("bbTopArrow"))):(B=o.top-g-r,(o.top<i||i>B)&&(B=o.bottom+r,u.removeClass("bbBottomArrow bbBottomArrowLeft").addClass("bbTopArrow"))),b>n?(P=C+b,u.removeClass("bbBottomArrowLeft")):b>a-n?(P=a+C-b-r,u.removeClass("bbBottomArrowLeft")):(P=C+n,u.removeClass("bbBottomArrowLeft")),tinymceBubbleBarAllowMulti(e)&&0===t.getBoundingClientRect().top&&0===t.getBoundingClientRect().width){var I=$(e.selection.getNode());B=I.offset().top-g-r,P=I.offset().left,u.removeClass("bbBottomArrow bbTopArrow").addClass("bbBottomArrowLeft")}if(u.find("[bb-set=show]:visible").length){var A=$(".mce-panel").css("background-color");u.css({top:B,left:P}).addClass("mce-tbActiveBar").css({"background-color":A,"border-color":A})}else u.removeClass("mce-tbActiveBar")}function tinymceBubbleBarIgnite(e,t,o,n){if(t){tinymceBubbleBarNewLineTrigger(e);var a;a=e.inline?$(e.getParam("fixed_toolbar_container")):$(e.getContainer()).find(".mce-toolbar-grp"),"addClass"==t&&a.addClass("mce-bubbleBar"),"addClassSticky"==t&&(a.hasClass("mce-bubbleBarSticky")?a.removeClass("mce-bubbleBarSticky"):a.addClass("mce-bubbleBarSticky"))}else setTimeout(function(){var t=e.selection.getRng(!0),a=$(e.selection.getNode()).attr("contenteditable"),i=""+t;"false"!==a&&""!==i.trim()||0===t.getBoundingClientRect().top&&tinymceBubbleBarAllowMulti(e)&&(1==o||38==o||40==o||13==o)?tinymceBubbleBarPosition(e,n):$(".mce-bubbleBar").removeClass("mce-tbActiveBar bbBottomArrow bbTopArrow bbBottomArrowLeft")},100)}function tinymceBubbleBarWordCount(e){var t=e.getParam("wordcount_countregex",/[\w\u2019\x27\-\u00C0-\u1FFF]+/g),o=e.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\x27\x22_+=\\\/\-]*/g),n=e.getContent({format:"raw"}),a=e.selection.getContent(),i=0,r=0,c=0,d=0;if(n){a&&""!==a&&(d=a.length,sel=a.replace(/\.\.\./g," ").replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," ").replace(/(\w+)(&#?[a-z0-9]+;)+(\w+)/i,"$1$3").replace(/&.+?;/g," ").replace(o,""),selArray=sel.match(t),selArray&&(c=selArray.length));var s=n.replace(/\.\.\./g," ").replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," ").replace(/(\w+)(&#?[a-z0-9]+;)+(\w+)/i,"$1$3").replace(/&.+?;/g," ").replace(o,""),l=s.match(t),m=$(e.getBody()).text().length;l&&(i=l.length),m&&(r=m)}$(".mce-npSelCount span.mce-text").text("Selected Words: "+c+", Characters: "+d),$(".mce-npCount span.mce-text").text("Word Count: "+i),$(".mce-npCSCount span.mce-text").text("Characters (+spaces): "+r),$(".mce-npPCount span.mce-text").text("Paragraphs: "+$(e.getBody()).find("p").length)}function tinymceBubbleBarNewLineTrigger(e){var t=e.getParam("bubbleBarSettings",{}).magicInsert||[];if(t.activate){var o=e.getParam("bubbleBarSettings",{}).magicInsert.tagTriggers||"h1, h2, h3, pre, p, p img, ol, ul, table, div, hr";$(e.getBody()).on("click",o,function(o){if(t.activate&&(o.metaKey||o.ctrlKey)){{var n=o.target;$(this)}$(n).after("<p id=_magicMtemp><br data-mce-bogus=1 /></p>"),e.selection.select(e.$("#_magicMtemp")[0]),e.$("#_magicMtemp").removeAttr("id"),setTimeout(function(){e.focus()},100)}})}}function twPreCodeManagerPREcssInit(e){var t="[twprecodemanagerprecss]{position:relative!important;max-height:100px!important;box-shadow:1px 2px 3px 3px grey;overflow:hidden!important;padding:10px!important}[twprecodemanagerprecss]:before{content:'';display:block!important;height:10px!important;position:absolute!important;bottom:-11px;width:90%;margin:auto;background:#fff;box-shadow:4px 12px 20px 20px #FBFBFB;left:0;right:0}[twprecodemanagerprecss][data-mce-selected]{outline:0!important;box-shadow:1px 2px 3px 3px #3B3A7D!important}";if(e.getParam("inline"))$("#twPreCodeManagerPREcss").length||$("head").append('<style id="twPreCodeManagerPREcss">'+t+"</style>");else{var o=$("#"+e.id+"_ifr").contents().find("head");o.find("#twPreCodeManagerPREcss").length||o.append('<style id="twPreCodeManagerPREcss">'+t+"</style>")}}function twPreCodeManagerInputBox(e,t,o){function n(e,t,o){var e=tinymce.activeEditor;e.undoManager.transact(function(){var n=a(e);if(tinymce.activeEditor.getParam("twPreCodeManagerSettings",{}).protectSquareBracket){var i=e.getParam("twPreCodeManagerSettings",{}).protectSquareBracketXter||"*";o=e.dom.encode(o.replace(/(?:\[\[)/g,"["+i+"["))}else o=e.dom.encode(o);if(n&&"PRE"==n.nodeName&&!e.getParam("twExoticMarkdownEditor",!1))n.setAttribute("class",$(".mce-preLanguageTextBox").val()),n.children[0]?(n.children[0].setAttribute("class",$(".mce-codeLanguageTextBox").val()),n.children[0].innerHTML=o):n.innerHTML=o,e.selection.select(n);else if(n&&"CODE"==n.nodeName&&"PRE"!==n.parentNode.nodeName&&!e.getParam("twExoticMarkdownEditor",!1))n.setAttribute("class",$(".mce-codeLanguageTextBox").val()),n.innerHTML=o,e.selection.select(n);else if(e.getParam("twExoticMarkdownEditor",!1)){var r="",c=o.split("\n");$.each(c,function(e,t){r+=t?"<p>"+t+"</p>":"<p><br></p>"}),e.insertContent("<p><br data-mce-bogus=1></p><p>```"+t+"</p>"+r.replace(/ /g,"&nbsp;")+"<p>```</p><p><br data-mce-bogus=1></p><p><br data-mce-bogus=1></p>")}else e.insertContent('<pre id="__new" class='+t+"><code class="+t+">"+o+"</code></pre>"),e.selection.select(tinymce.activeEditor.$("#__new").removeAttr("id")[0])})}function a(){var e=tinymce.activeEditor.selection.getNode();return e&&"CODE"==e.nodeName&&"PRE"!==e.parentNode.nodeName||"PRE"==e.nodeName?e:null}function i(e){var t=a(e);return t?"PRE"==t.nodeName&&t.children[0]?t.firstChild.innerText:"PRE"!=t.nodeName||t.children[0]?"CODE"==t.nodeName&&"PRE"!==t.parentNode.nodeName?t.innerText:void 0:t.innerText:""}function r(e){var t,o=a(e);return o&&"PRE"==o.nodeName?(t=o.className,t?t:""):""}function c(e){var t,o=a(e);return o&&"CODE"==o.nodeName&&"PRE"!==o.parentNode.nodeName?(t=o.className,t?t:""):o&&o.firstChild?(t=o.firstChild.className,t?t:""):""}var d=[{text:"Library Presets",value:""},{text:"Highlight",value:"highlight"},{text:"Prism",value:"language-"},{text:"Prettyprint",value:"prettyprint"}],s=[{text:"Language Names",value:""},{text:"CSS",value:"css"},{text:"HTML",value:"markup"},{text:"JavaScript",value:"javascript"},{text:"JSON",value:"json"},{text:"PHP",value:"php"},{text:"--------------",value:"",disabled:!0},{text:"ABAP",value:"abap"},{text:"ActionScript",value:"actionscript"},{text:"Apache Configuration",value:"apacheconf"},{text:"APL",value:"apl"},{text:"AppleScript",value:"applescript"},{text:"AsciiDoc",value:"asciidoc"},{text:"ASP.NET (C#)",value:"aspnet"},{text:"AutoHotkey",value:"autohotkey"},{text:"AutoIt",value:"autoit"},{text:"BASIC",value:"basic"},{text:"C-like",value:"clike"},{text:"CoffeeScript",value:"coffeescript"},{text:"C++",value:"cpp"},{text:"C#",value:"csharp"},{text:"CSS",value:"css"},{text:"CSS Extras",value:"css-extras"},{text:"F#",value:"fsharp"},{text:"GLSL",value:"glsl"},{text:"HTML",value:"markup"},{text:"HTTP",value:"http"},{text:"Inform 7",value:"inform7"},{text:"JavaScript",value:"javascript"},{text:"JSON",value:"json"},{text:"React JSX",value:"jsx"},{text:"LaTeX",value:"latex"},{text:"LOLCODE",value:"lolcode"},{text:"MathML",value:"mathml"},{text:"MATLAB",value:"matlab"},{text:"MEL",value:"mel"},{text:"NASM",value:"nasm"},{text:"nginx",value:"nginx"},{text:"NSIS",value:"nsis"},{text:"Objective-C",value:"objectivec"},{text:"OCaml",value:"ocaml"},{text:"PARI/GP",value:"parigp"},{text:"PHP",value:"php"},{text:"PHP Extras",value:"php-extras"},{text:"PowerShell",value:"powershell"},{text:"reST (reStructuredText)",value:"rest"},{text:"SAS",value:"sas"},{text:"Sass (Sass)",value:"sass"},{text:"Sass (Scss)",value:"scss"},{text:"SQL",value:"sql"},{text:"SVG",value:"svg"},{text:"TypeScript",value:"typescript"},{text:"VHDL",value:"vhdl"},{text:"vim",value:"vim"},{text:"Wiki markup",value:"wiki"},{text:"XML",value:"xml"},{text:"YAML",value:"yaml"}];return{open:function(e){e.windowManager.open({title:"<pre><code> Manager",width:t,height:o,layout:"fit",body:[{type:"textbox",tooltip:"Enter classes directly",name:"language",label:"PRE classes",maxWidth:200,value:r(e),classes:"preLanguageTextBox",onPostRender:function(){var e=tinymce.activeEditor.selection.getNode();e&&"CODE"==e.nodeName&&"PRE"!==e.parentNode.nodeName&&$(".mce-preLanguageTextBox").parent().parent().hide()}},{type:"textbox",tooltip:"Enter classes directly",label:"CODE classes",maxWidth:200,value:c(e),classes:"codeLanguageTextBox",onPostRender:function(){var e=tinymce.activeEditor.selection.getNode();e&&"PRE"==e.nodeName&&!e.children[0]&&tinymce.activeEditor.getParam("twPreCodeManagerSettings",{}).managerForceCODEtag&&(e.innerHTML="<code></code>"),(e&&"PRE"==e.nodeName&&!e.children[0]||tinymce.activeEditor.getParam("twExoticMarkdownEditor",!1))&&$(".mce-codeLanguageTextBox").parent().parent().hide()}},{type:"listbox",label:"Libraries",maxWidth:200,value:r(e)||c(e),values:d,classes:"libListBox",onselect:function(){var e=$(".mce-preLanguageTextBox")[0].value?$(".mce-preLanguageTextBox")[0].value+" ":"";$(".mce-preLanguageTextBox").length&&($(".mce-preLanguageTextBox")[0].value=e+this.value());var t=$(".mce-codeLanguageTextBox")[0].value?$(".mce-codeLanguageTextBox")[0].value+" ":"";$(".mce-codeLanguageTextBox")[0].value=t+this.value()}},{type:"listbox",label:"Languages",maxWidth:200,value:r(e)||c(e),values:s,classes:"languageListBox",onselect:function(){var e=$(".mce-preLanguageTextBox")[0].value?$(".mce-preLanguageTextBox")[0].value+" ":"";$(".mce-preLanguageTextBox").length&&($(".mce-preLanguageTextBox")[0].value=e+this.value());var t=$(".mce-codeLanguageTextBox")[0].value?$(".mce-codeLanguageTextBox")[0].value+" ":"";$(".mce-codeLanguageTextBox")[0].value=t+this.value()}},{type:"textbox",name:"code",multiline:!0,spellcheck:!1,ariaLabel:"Code view",flex:1,style:"direction: ltr; text-align: left",value:i(e),classes:"codeTextarea",onPostRender:function(){$(".mce-codeTextarea").attr("placeholder","Just paste your source code. It will automatically and safely be entitized. All Markdown is left as is")}}],onSubmit:function(t){if($(".mce-codeTextarea").val()){n(e,t.data.language,t.data.code);{tinymce.activeEditor.selection.getNode()}}}})}}}function transformMarks(e,t){if(e.getParam("inline"))var o=$("textarea[name="+t+"]").val();else var o=e.getElement().value;var n=new showdown.Converter;document.getElementById("codeT"+t)&&(targetArea=document.getElementById("codeT"+t),text=o,data=n.makeHtml(text),targetArea.innerHTML=data,tinymce.activeEditor.getParam("twShowdownSettings",{}).twEnableMathJax!==!1&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,"codeT"+t]))}function popShowdown(e,t,o,n,a){var e=$(e),i=e.data("origin"),r=$("<div>").hide().insertBefore(e);tinymce.activeEditor.windowManager.open({title:t,width:o,height:n,classes:"popCode "+i,onclose:function(e){e.preventDefault;0==twShowdownKillCodeSecure&&killCodeShowdown(i,1)},items:[{classes:"popShowdown "+i,type:"container",onPostRender:function(){twShowdownKillCode=0,twShowdownKillCodeSecure=0,$(e).appendTo(".mce-popShowdown.mce-"+i+" > .mce-container-body"),setTimeout(function(){$(".mce-popCode.mce-"+i).removeClass("mce-container").find("*").removeClass("mce-container"),$(".mce-popCode.mce-"+i+" .mce-close").addClass("mce-reset");var e=setInterval(function(){$(".mce-popShowdown.mce-"+i+" .showdown").length&&(transformMarks(tinymce.activeEditor,i),clearInterval(e));$(".codeT."+i).data("height");$("#codeT"+i+", .coderSNparent."+i).css({"max-width":o,height:n})},100)},100)}}],buttons:[{text:a,active:!0,onclick:function(){var t=$("#"+i).width(),o=$("#codeT"+i).data("height"),n=o-5;$(".coderSNparent."+i).css({"max-width":t,height:o}),$("#codeT"+i).css({"max-width":t,height:n}),r.replaceWith(e),twShowdownKillCode=0,twShowdownKillCodeSecure=1,tinymce.activeEditor.windowManager.close()}}]})}function killCodeShowdown(e,t){1==t&&($(".coderSNparent."+e).remove(),tinymce.activeEditor.windowManager.close())}function popCodeShowdown(e){var t=tinymce.get(e).getParam("twShowdownSettings",{}).twPoppedTitle||"Markdown / MathJax Preview",o=tinymce.get(e).getParam("twShowdownSettings",{}).twPoppedWidth||window.innerWidth/1.2,n=tinymce.get(e).getParam("twShowdownSettings",{}).twPoppedHeight||300,a=tinymce.get(e).getParam("twShowdownSettings",{}).twViewInlineButtonText||"View Inline",i=tinymce.get(e).getParam("twShowdownSettings",{}).twCloseButtonText||"Close",r=tinymce.get(e).getParam("twShowdownSettings",{}).twInlineWidth||"auto",c=tinymce.get(e).getParam("twShowdownSettings",{}).twInlineHeight||250;popShowdown(".coderSNparent."+e,t,o,n,a,i,r,c)}function saveMyFootMarks(e){var t=$("<div />").html(e);t.find("p").each(function(){$(this).find("br").remove(),""!==$(this).text().trim()?$(this).contents().unwrap().after("\n"):$(this).replaceWith("\n")});var o=t.html(),n=tinymce.html.Entities.decode(o.replace(/(?:<br>|<br \/>)/g,"").replace(/(&nbsp;)/g," ").replace(/(?:&amp;gt;|&gt;)/g,">").replace(/(?:&amp;)/g,"&"));return n}function getMyFootMarks(e){var t=tinymce.html.Entities.encodeAllRaw(e).replace(/  /g," &nbsp;"),o="",n=t.split("\n");$.each(n,function(e,t){o+=t?"<p>"+t+"</p>":"<p><br data-mce-bogus=1></p>"});var a=o.replace(/(?:&amp;gt;|&gt;)/g,">").replace(/(?:&amp;)/g,"&");return a}function makeMyFootMarks(e,t,o,n){var a=e.selection.getContent();""!==a.trim()&&(o=a.trim()),e.undoManager.transact(function(){e.selection.setContent(t+o+n)})}function popMirror(e,t,o,n,a,i,r,c){var e=$(e),d=e.data("origin"),s=$("<div>").hide().insertBefore(e);tinymce.activeEditor.windowManager.open({title:t,width:o,height:n,classes:"popCode "+d,onclose:function(e){e.preventDefault;0==twCodeMirrorKillCodeSecure&&killCode(d,1)},items:[{classes:"popCodeMirror "+d,type:"container",onPostRender:function(){twCodeMirrorKillCode=0,twCodeMirrorKillCodeSecure=0,$(e).appendTo(".mce-popCodeMirror.mce-"+d+" > .mce-container-body"),setTimeout(function(){$(".mce-popCode.mce-"+d).removeClass("mce-container").find("*").removeClass("mce-container"),$(".mce-popCode.mce-"+d+" .mce-close").addClass("mce-reset"),window["codeT"+d].refresh();var e=setInterval(function(){$(".mce-popCodeMirror.mce-"+d+" .CodeMirror").length&&($(".mce-popCodeMirror.mce-"+d+" .coder").css({width:o,height:n}),clearInterval(e))},100)},100)}}],buttons:[{text:a,active:!0,onclick:function(){$(".mce-popCodeMirror.mce-"+d+" .coder").css({width:r,height:c}),s.replaceWith(e),window["codeT"+d].refresh(),twCodeMirrorKillCode=0,twCodeMirrorKillCodeSecure=1,tinymce.activeEditor.windowManager.close()}}]})}function killCode(e,t){1==t&&(codeMirrorSetContentsilent=!0,$("#"+e).html(window["codeT"+e].getValue()),window["codeT"+e].toTextArea(),$(".coder."+e).remove(),tinymce.activeEditor.windowManager.close())}function popCode(e){var t=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twPoppedTitle||"CodeMirror HTML Source Code",o=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twPoppedWidth||window.innerWidth/1.2,n=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twPoppedHeight||300,a=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twViewInlineButtonText||"View Inline",i=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twCloseButtonText||"Close",r=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twInlineWidth||"auto",c=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twInlineHeight||250;popMirror(".coder."+e,t,o,n,a,i,r,c)}function popAce(e,t,o,n,a,i,r,c){var e=$(e),d=e.data("origin"),s=$("<div>").hide().insertBefore(e);tinymce.activeEditor.windowManager.open({title:t,width:o,height:n,classes:"popCode "+d,onclose:function(e){e.preventDefault;0==twAceEditorKillCodeSecure&&killCodeAce(d,1)},items:[{classes:"popAceEditor "+d,type:"container",onPostRender:function(){twAceEditorKillCode=0,twAceEditorKillCodeSecure=0,$(e).appendTo(".mce-popAceEditor.mce-"+d+" > .mce-container-body"),setTimeout(function(){$(".mce-popCode.mce-"+d).removeClass("mce-container").find("*").removeClass("mce-container"),$(".mce-popCode.mce-"+d+" .mce-close").addClass("mce-reset"),window["codeT"+d].resize();var e=setInterval(function(){$(".mce-popAceEditor.mce-"+d+" .ace_editor").length&&($(".mce-popAceEditor.mce-"+d+" .coder").css({width:o,height:n}),clearInterval(e))},100)},100)}}],buttons:[{text:a,active:!0,onclick:function(){$(".mce-popAceEditor.mce-"+d+" .coder").css({width:r,height:c}),s.replaceWith(e),window["codeT"+d].resize(),twAceEditorKillCode=0,twAceEditorKillCodeSecure=1,tinymce.activeEditor.windowManager.close()}}]})}function killCodeAce(e,t){1==t&&(aceSetContentsilent=!0,$("#"+e).html(window["codeT"+e].getValue()),window["codeT"+e].remove(),$(".coder."+e).remove(),tinymce.activeEditor.windowManager.close())}function popCodeAce(e){var t=tinymce.get(e).getParam("twAceEditorSettings",{}).twPoppedTitle||"Ace HTML Source Code",o=tinymce.get(e).getParam("twAceEditorSettings",{}).twPoppedWidth||window.innerWidth/1.2,n=tinymce.get(e).getParam("twAceEditorSettings",{}).twPoppedHeight||300,a=tinymce.get(e).getParam("twAceEditorSettings",{}).twViewInlineButtonText||"View Inline",i=tinymce.get(e).getParam("twAceEditorSettings",{}).twCloseButtonText||"Close",r=tinymce.get(e).getParam("twAceEditorSettings",{}).twInlineWidth||"auto",c=tinymce.get(e).getParam("twAceEditorSettings",{}).twInlineHeight||250;popAce(".coder."+e,t,o,n,a,i,r,c)}tinymce.PluginManager.add("structures",function(e){function t(t){var o=$(e.getBody());if($(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img"))var n="img";else var n="pre";if(o.children(n).length&&$(e.getBody()).html(o.children(n+":first")),"click"==t){var a=e.dom.select(n);e.selection.select(a[0]),top.tinymce.activeEditor.windowManager.close(),setTimeout(function(){$(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img")?e.execCommand("mceImage",!0):e.execCommand("twPreCodeManager",!0)},100)}}e.on("init",function(){if($(e.getBody()).parent().find(".tb-name").html(e.settings.name),$(e.getBody()).on("dblclick",".tb-mini",function(){$(this).children().addClass("mceEditable").attr("contenteditable",!0)}),($(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img")||$(e.getBody()).hasClass("tb-tiny-dc"))&&$(e.getBody()).attr("contenteditable",!1),e.getParam("addClasses",{}).toParent&&$(e.getBody()).parent().addClass(e.getParam("addClasses",{}).toParent),e.getParam("addClasses",{}).toSelf&&$(e.getBody()).addClass(e.getParam("addClasses",{}).toSelf),e.getParam("tbRapidImageSettings",{})){var t=$(e.getBody()).find("img");t.each(function(){var e=$(this),t=e.attr("src");if(t){var o=t.substr(t.lastIndexOf("/")+1);e.attr("data-tb-rapid",o)}})}e.getParam("tbRapidImageSettings",{}).uploadScriptUrl&&e.getParam("tbRapidImageSettings",{}).uploadPath&&e.getParam("tbRapidImageSettings",{}).uploadUrl&&(window["tinyBlocksUploadScriptUrl_"+e.id]=e.getParam("tbRapidImageSettings").uploadScriptUrl,window["tinyBlocksUploadPath_"+e.id]=e.getParam("tbRapidImageSettings").uploadPath,window["tinyBlocksUploadUrl_"+e.id]=e.getParam("tbRapidImageSettings").uploadUrl)}),e.on("LoadContent blur",function(){($(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img")||$(e.getBody()).hasClass("tb-tiny-dc"))&&t()}),e.on("click",function(){($(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img")||$(e.getBody()).hasClass("tb-tiny-dc"))&&t("click")}),e.addMenuItem("rapidImage",{icon:"upload",text:"Rapid Image Settings",onclick:function(){rapidImageChangeUploadPath(e)}}),e.addMenuItem("JSONgallery",{icon:"image",text:"Gallery Manager",onclick:function(){tinyBlocksGalleryTinyJSON()}})}),tinymce.PluginManager.add("bubbleBar",function(e){e.addCommand("tinymceBubbleBar",function(){}),e.on("init",function(){tinymceBubbleBarCSSInit(e),tinymceBubbleBarIgnite(e,"addClass"),e.settings.tinymceBubbleBar=!0}),e.on("keyup mouseup",function(t){tinymceBubbleBarIgnite(e,"",t.which,t.pageY)}),e.on("blur",function(){$(".mce-bubbleBar").removeClass("mce-tbActiveBar")}),e.on("focus mouseup keyup change",function(){tinymceBubbleBarWordCount(e)}),e.on("DblClick",function(t){"IMG"==t.target.nodeName&&e.execCommand("mceImage",!0),"A"==t.target.nodeName&&e.execCommand("mceLink",!0)}),e.addButton("bubbleBarOptionsButton",{type:"menubutton",text:"...",classes:e.id+" bubbleBarOptionsButton",tooltip:"tinymceBubbleBar options",autohide:!1,onclick:function(){setTimeout(function(){tinymceBubbleBarWordCount(e)},200)},menu:[{text:"Toggle Sticky",onclick:function(){tinymceBubbleBarIgnite(e,"addClassSticky")}},{text:"Word Count: 000000",classes:"npCount",menu:[{classes:"npCSCount",text:"Characters (+spaces): 0000000",onPostRender:function(){setTimeout(function(){tinymceBubbleBarWordCount(e)},200)}},{classes:"npPCount",text:"Paragraphs: 000000 "},{classes:"npSelCount",text:"Selected Words: 000, Characters: 0000"}]}]})}),tinymce.PluginManager.add("twPreCodeManager",function(e){e.on("init",function(){twPreCodeManagerPREcssInit(e)}),e.on("SetContent",function(){1==e.getParam("twPreCodeManagerSettings",{}).contentEditable||$(e.getBody()).find("pre").attr("contenteditable",!1),e.getParam("twPreCodeManagerSettings",{}).managerPREcss!==!1&&$(e.getBody()).find("pre").attr("twprecodemanagerprecss",1)}),e.addCommand("twPreCodeManager",function(){var t=e.getParam("twPreCodeManagerSettings",{}).managerWidth||window.innerWidth/1.4,o=e.getParam("twPreCodeManagerSettings",{}).managerHeight||window.innerHeight/1.5;twPreCodeManagerInputBox(e,t,o).open(e)}),e.addButton("twPreCodeManager",{icon:"codesample",cmd:"twPreCodeManager",title:"Insert/edit <pre><code>"}),e.addMenuItem("twPreCodeManager",{icon:"codesample",cmd:"twPreCodeManager",text:"Insert/edit <pre><code>"}),e.on("DblClick",function(t){("PRE"==t.target.nodeName||"CODE"==t.target.nodeName&&"PRE"==t.target.parentNode.nodeName||"CODE"==t.target.nodeName&&"PRE"!==t.target.parentNode.nodeName)&&e.execCommand("twPreCodeManager",!0)}),e.on("LoadContent",function(){e.getParam("twPreCodeManagerSettings",{}).protectSquareBracket&&$(e.getBody()).find("code").each(function(){var t=$(this).html(),o=e.getParam("twPreCodeManagerSettings",{}).protectSquareBracketXter||"*";$(this).html(t.replace(/(?:\[\[)/g,"["+o+"["))})})}),showDownInnerInitRTE=function(e){var t={},o=$.extend({},t,e);return o},tinymce.PluginManager.add("twShowdown",function(e){function t(o){if(1==o)popCodeShowdown(e.id);else if(0==o){var n=e.getParam("twShowdownSettings",{}).twInlineWidth||"auto",a=e.getParam("twShowdownSettings",{}).twInlineHeight||250;if(e.getParam("inline"))var i=e.id;else var i=e.getContainer().id;$("#"+i).before("<div style=dispaly:none; class='coderSNparent "+e.id+"' data-origin="+e.id+"><span type=button onclick='killCodeShowdown(\""+e.id+"\",1)' class='mce-close-button mce-reset'  title='Close this Showdown'><i class='mce-ico mce-i-remove'></i></span><div class='showdown codeT' id='codeT"+e.id+"' data-height="+a+" data-width="+n+"></div>");var r=$("#"+i).width(),c=a-5;$("#codeT"+e.id).css({"max-width":r,height:c}),$(".coderSNparent."+e.id).css({"max-width":r,height:a}).fadeIn(),transformMarks(e,e.id),$(window).resize(function(){$(".coderSNparent."+e.id).length&&$(".codeT."+e.id+", .coderSNparent."+e.id).css("max-width",r)}),e.on("change InsertContent",function(){transformMarks(e,e.id)}),0!==e.getParam("twShowdownSettings",{}).twPopped&&popCodeShowdown(e.id)}else $(".coderSNparent."+e.id).length?popCodeShowdown(e.id):t(0)}function o(o){var n='<style id="mainCSSshowDown">.x-window-body{overflow-x:hidden!important;}.codeT,.coderSNparent{position:relative; margin:auto}.mce-popCode .mce-title{text-align:center;} .mce-popCode .mce-close-button{display:none;}.coderSNparent > .mce-close-button{position:absolute;top:-22px;right:0;cursor: pointer;background: #FFF;margin: 0 19px -4px 0;text-align: center;border-radius: 5px 5px 0 0;padding: 2px;box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4);}.mce-popShowdown,.mce-popShowdown .mce-container-body{width:inherit!important}.coderSNparent .showdown{white-space: normal !important;word-wrap: break-word;box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4); width:inherit;height:inherit;overflow:auto;padding:10px ;margin:auto}.mce-popCode .showdown{box-shadow:none;}.coderSNparent > .mce-close-button > .mce-ico{font-size:15px; color:#000;}</style>';if($("#mainCSSshowDown").length||$("head").append(n),"undefined"==typeof showdown){{var a=e.getParam("twShowdownSettings",{}).twShowdownCDNbase||"https://cdnjs.cloudflare.com/ajax/libs/showdown/1.4.1/",i=e.getParam("twShowdownSettings",{}).twMathJaxURL||"https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML",r=new tinymce.dom.ScriptLoader;new tinymce.dom.ScriptLoader}r.add(a+"showdown.min.js"),"undefined"==typeof MathJax&&e.getParam("twShowdownSettings",{}).twEnableMathJax!==!1&&r.add(i),r.loadQueue(function(){setTimeout(function(){t(o)},500)})}else t(o)}$("#"+e.id);e.on("focus change",function(){e.save()}),e.addButton("preview",{type:"button",icon:"preview",tooltip:"Markdown/MathJax Preview",onclick:function(){$(".mce-popShowdown.mce-"+e.id).length||o()}}),e.addMenuItem("preview",{icon:"preview",text:"Markdown/MathJax Preview",onclick:function(){$(".mce-popShowdown.mce-"+e.id).length||o()}})});var miniCSS='<style id="modxMagicHoverLinkCSS">.moce-useMODX button{background-image: linear-gradient(to right,#3f4850 0,#365462 46%,#3e5554 60%,#42554d 68%,#573d4e 100%); box-shadow: 0 2px 0 #E4E4E4; color:white!important;}#themChecks{display:none;position:absolute;top:17px;left:60px}.mce-themChecks{display:inline;margin-left:8px !important;}.mce-themChecksMORE,.mce-themChecksScMORE{height: 23px !important;width: 20px!important;background: none!important;box-shadow: none!important;border: 0!important;margin-left: 0 !important;text-align: center!important;}.mce-themChecksMORE button,.mce-themChecksScMORE button{padding:0!important;}.twEasyHover{padding-top:20px!important;padding-bottom:20px!important;}.twEasyHover,.twEasyHover *{cursor:default!important;}.twEasyHover:before{content:"";position:absolute;width:100%;height:100%;}.mce-themChecksIMAGE{position:absolute!important;top:12px!important;z-index:2;}</style>';
$("#modxMagicHoverLinkCSS").length||$("head").append(miniCSS),tinyMODXselectedID=!1,$(document).on("mouseenter","[ext\\:tree-node-id]",function(){if($(".mce-useMODX").hasClass("useMODXyes")){tinyMODXselectedTEXT=$(this).find("a > span").clone().children().remove().end().text().trim(),tinyMODXselectedTITLE=$(this).find("a > span").clone().html($(this).find("a > span").attr("qtip")).text().trim();var e=$("[class^=mce-themChecksMORE].mce-active").attr("scheme")?"? &scheme=`"+$("[class^=mce-themChecksMORE].mce-active").attr("scheme")+"`":"";tinyMODXselectedID=$(this).find("a > span > span").text().replace(/\D/g,""),tinyMODXselectedID&&tinyMODXselectedTEXT&&(("true"==$(".mce-themChecksURL").attr("aria-checked")||"true"==$(".mce-themChecksTXT").attr("aria-checked")||"true"==$(".mce-themChecksTITLE").attr("aria-checked"))&&tinymce.activeEditor.getParam("modxMagicHoverLinkSettings",{}).addClassToTree!==!1&&$(this).addClass("twEasyHover"),"true"==$(".mce-themChecksURL").attr("aria-checked")&&$(".mce-modxUrl input.mce-textbox").val("[[~"+tinyMODXselectedID+e+"]]"),"true"==$(".mce-themChecksTXT").attr("aria-checked")&&$(".mce-tinyMODXselected").val(tinyMODXselectedTEXT),"true"==$(".mce-themChecksTITLE").attr("aria-checked")&&$(".mce-modxTitle").val($(".mce-themChecksMOREdesc").hasClass("mce-active")?tinyMODXselectedTITLE:tinyMODXselectedTEXT))}}).on("mouseleave","[ext\\:tree-node-id]",function(){$(".twEasyHover").removeClass("twEasyHover")}),$(document).on("mouseenter","[class^=mce-tinyMODXLinkList]",function(){if(tinyMODXselectedID=$(this).attr("class"),$(".mce-useMODX").hasClass("useMODXyes")&&tinyMODXselectedID.indexOf("[[~")>-1){tinyMODXselectedTEXT=$(this).find("span.mce-text").text().trim(),tinyMODXselectedTITLE=$(this).find("span.mce-text").text().trim();var e=$("[class^=mce-themChecksMORE].mce-active").attr("scheme")?"? &scheme=`"+$("[class^=mce-themChecksMORE].mce-active").attr("scheme")+"`":"";tinyMODXselectedID=tinyMODXselectedID.replace(/\D/g,""),tinyMODXselectedID&&tinyMODXselectedTEXT&&($(".mce-themChecksURL:visible").length&&"true"==$(".mce-themChecksURL").attr("aria-checked")&&$(".mce-modxUrl input.mce-textbox").val("[[~"+tinyMODXselectedID+e+"]]"),"true"==$(".mce-themChecksTXT").attr("aria-checked")&&$(".mce-tinyMODXselected").val(tinyMODXselectedTEXT),"true"==$(".mce-themChecksTITLE").attr("aria-checked")&&$(".mce-modxTitle").val($(".mce-themChecksMOREdesc").hasClass("mce-active")?tinyMODXselectedTITLE:tinyMODXselectedTEXT))}}),$(document).on("mouseenter","div.section > p.x-combo-list-item > a",function(){if($(".mce-useMODX").hasClass("useMODXyes")){tinyMODXselectedTEXT=$(this).clone().children().remove().end().text().trim(),tinyMODXselectedTITLE=$(this).parent().next("ol").text().trim()||$(this).children("em").text(),tinyMODXselectedID=$(this).attr("href"),tinyMODXselectedID=tinyMODXselectedID.split("resource/update&id=");var e=$("[class^=mce-themChecksMORE].mce-active").attr("scheme")?"? &scheme=`"+$("[class^=mce-themChecksMORE].mce-active").attr("scheme")+"`":"";tinyMODXselectedID=tinyMODXselectedID[1],tinyMODXselectedID&&tinyMODXselectedTEXT&&("true"==$(".mce-themChecksURL").attr("aria-checked")&&$(".mce-modxUrl input.mce-textbox").val("[[~"+tinyMODXselectedID+e+"]]"),"true"==$(".mce-themChecksTXT").attr("aria-checked")&&$(".mce-tinyMODXselected").val(tinyMODXselectedTEXT),"true"==$(".mce-themChecksTITLE").attr("aria-checked")&&$(".mce-modxTitle").val($(".mce-themChecksMOREdesc").hasClass("mce-active")?tinyMODXselectedTITLE:tinyMODXselectedTEXT))}}),tinymce.PluginManager.add("modxMagicHoverLink",function(e){function t(t){return function(){var o=e.settings.link_list;"string"==typeof o?tinymce.util.XHR.send({url:o,success:function(e){t(tinymce.util.JSON.parse(e))}}):"function"==typeof o?o(t):t(o)}}function o(e,t,o){function n(e,o){return o=o||[],tinymce.each(e,function(e){var a={text:e.text||e.title};e.menu?(a.menu=n(e.menu),a.classes="tinyMODXLinkList"+e.value):(a.value=e.value,a.classes="tinyMODXLinkList"+e.value,t&&t(a)),o.push(a)}),o}return n(e,o||[])}function n(t){function n(e){var t=m.find("#text");(!t.value()||e.lastControl&&t.value()==e.lastControl.text())&&t.value(e.control.text()),m.find("#href").value(e.control.value())}function a(t){var o=[];return tinymce.each(e.dom.select("a:not([href])"),function(e){var n=e.name||e.id;n&&o.push({text:n,value:"#"+n,selected:-1!=t.indexOf("#"+n)})}),o.length?(o.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:o,onselect:n}):void 0}function i(){!l&&0===C.text.length&&p&&this.parent().parent().find("#text")[0].value(this.value())}function r(t){var o=t.meta||{};g&&g.value(e.convertURL(this.value(),"href")),tinymce.each(t.meta,function(e,t){m.find("#"+t).value(e)}),o.text||i.call(this)}function c(e){var t=v.getContent();if(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1==t.indexOf("href=")))return!1;if(e){var o,n=e.childNodes;if(0===n.length)return!1;for(o=n.length-1;o>=0;o--)if(3!=n[o].nodeType)return!1}return!0}if($(".mce-useMODX").length)e.windowManager.alert("modxMagicHoverLink does not allow multiple instances");else{var d,s,l,m,p,u,g,h,b,w,f,x,C={},v=e.selection,y=e.dom;if(d=v.getNode(),s=y.getParent(d,"a[href]"),p=c(),C.text=l=s?s.innerText||s.textContent:v.getContent({format:"text"}),C.href=s?y.getAttrib(s,"href"):"",s?C.target=y.getAttrib(s,"target"):e.settings.default_link_target&&(C.target=e.settings.default_link_target),(x=y.getAttrib(s,"rel"))&&(C.rel=x),(x=y.getAttrib(s,"class"))&&(C["class"]=x),(x=y.getAttrib(s,"title"))&&(C.title=x),p){if(e.getParam("twExoticMarkdownEditor",!1))var M="Text",k="Link Text or Image Description (ALT)";u={name:"text",classes:"tinyMODXselected",type:"textbox",size:40,tooltip:k?k:"",label:M?M:"Text to display",onchange:function(){C.text=this.value()}}}if(t&&(g={type:"listbox",label:"Link list",classes:"tinyMODXLinkList",values:o(t,function(t){-1==t.value.indexOf("[[~")&&(t.value=e.convertURL(t.value||t.url,"href"))},[{text:"None",value:""}]),onselect:n,value:e.convertURL(C.href,"href"),onPostRender:function(){g=this}}),e.settings.target_list===!1||e.getParam("twExoticMarkdownEditor",!1)||(e.settings.target_list||(e.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),b={name:"target",type:"listbox",label:"Target",values:o(e.settings.target_list)}),e.settings.rel_list&&!e.getParam("twExoticMarkdownEditor",!1)&&(h={name:"rel",type:"listbox",label:"Rel",values:o(e.settings.rel_list)}),e.settings.link_class_list&&!e.getParam("twExoticMarkdownEditor",!1)&&(w={name:"class",type:"listbox",label:"Class",values:o(e.settings.link_class_list,function(t){t.value&&(t.textStyle=function(){return e.formatter.getCssText({inline:"a",classes:[t.value]})})})}),e.settings.link_title!==!1&&(f={name:"title",type:"textbox",label:"Title",classes:"modxTitle",value:C.title}),e.getParam("twExoticMarkdownEditor",!1))var M="Insert Link / Image";m=e.windowManager.open({title:M?M:"Insert Link",data:C,minWdth:450,onPostRender:function(){var t=$(".mce-foot > .mce-container-body.mce-abs-layout").attr("id");$(".mce-foot > .mce-container-body.mce-abs-layout").append("<div id='themChecks'></div>"),tinymce.ui.Factory.create({type:"button",icon:"fullpage",tooltip:"Toggle. HOVER over any Resource in Resource Tree, Search Result Tree or Link List.",classes:"useMODX",style:"position:absolute;top:10px;left:8px;",onPostRender:function(){$(".mce-useMODX").on("click",function(){$("#modx-leftbar").length||$(".mce-tinyMODXLinkList").length?$(this).hasClass("useMODXyes")?($(this).removeClass("useMODXyes"),$("#themChecks").fadeOut(),$("#modx-leftbar").length&&$("#mce-modal-block:hidden").length&&$("#mce-modal-block").show()):($(this).addClass("useMODXyes"),$("#themChecks").fadeIn(),$("#modx-leftbar").length&&$("#mce-modal-block:visible").length&&$("#mce-modal-block").fadeOut()):e.windowManager.alert("Required: MODX Resource Tree or Link List")})}}).renderTo(document.getElementById(t)),tinymce.ui.Factory.create({type:"checkbox",tooltip:"Autofill URL? + scheme",checked:!0,classes:"themChecks themChecksURL",text:"URL"}).renderTo(document.getElementById("themChecks")),tinymce.ui.Factory.create({type:"menubutton",tooltip:"Scheme Options",classes:"themChecks themChecksScMORE",menu:[{text:"Relative",classes:"themChecksMORErel",onclick:function(){$(".mce-themChecksMORErel").parent().children().removeClass("mce-active"),$(".mce-themChecksMORErel").addClass("mce-active")}},{text:"Full",classes:"themChecksMOREfull",onclick:function(){$(".mce-themChecksMOREfull").parent().children().removeClass("mce-active"),$(".mce-themChecksMOREfull").addClass("mce-active").attr("scheme","full")}},{text:"Absolute",classes:"themChecksMOREabs",onclick:function(){$(".mce-themChecksMOREabs").parent().children().removeClass("mce-active"),$(".mce-themChecksMOREabs").addClass("mce-active").attr("scheme","abs")}},{text:"HTTP",classes:"themChecksMOREhttp",onclick:function(){$(".mce-themChecksMOREhttp").parent().children().removeClass("mce-active"),$(".mce-themChecksMOREhttp").addClass("mce-active").attr("scheme","http")}},{text:"HTTPS",classes:"themChecksMOREhttps",onclick:function(){$(".mce-themChecksMOREhttps").parent().children().removeClass("mce-active"),$(".mce-themChecksMOREhttps").addClass("mce-active").attr("scheme","https")}}]}).renderTo(document.getElementById("themChecks")),$(".mce-tinyMODXselected").length&&tinymce.ui.Factory.create({type:"checkbox",tooltip:"Autofill Text To Display?",classes:"themChecks themChecksTXT",text:"Text"}).renderTo(document.getElementById("themChecks")),tinymce.ui.Factory.create({type:"checkbox",tooltip:"Autofill Title?",classes:"themChecks themChecksTITLE",text:"Title"}).renderTo(document.getElementById("themChecks")),tinymce.ui.Factory.create({type:"menubutton",tooltip:"Title Options",classes:"themChecks themChecksMORE",menu:[{text:"Use Resource Description",classes:"themChecksMOREdesc",onclick:function(){$("#modx-leftbar").length?$(".mce-themChecksMOREdesc").hasClass("mce-active")?$(".mce-themChecksMOREdesc").removeClass("mce-active"):$(".mce-themChecksMOREdesc").addClass("mce-active"):e.windowManager.alert("Required: MODX Resource Tree")}}]}).renderTo(document.getElementById("themChecks")),e.getParam("twExoticMarkdownEditor",!1)&&tinymce.ui.Factory.create({type:"checkbox",tooltip:"Insert image instead",classes:"themChecks themChecksIMAGE"}).renderTo(document.getElementById($(".mce-title").attr("id")))},body:[{name:"href",type:"filepicker",filetype:"file image media",size:40,autofocus:!0,label:"Url",classes:"modxUrl",onchange:r,onkeyup:i},u,f,a(C.href),g,h,b,w],onSubmit:function(t){function o(t,o){var n=e.selection.getRng();tinymce.util.Delay.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(n),o(t)})})}function n(){var t={href:a,target:C.target?C.target:null,rel:C.rel?C.rel:null,"class":C["class"]?C["class"]:null,title:C.title?C.title:null};if(s)e.focus(),p&&C.text!=l&&("innerText"in s?s.innerText=C.text:s.textContent=C.text),y.setAttribs(s,t),v.select(s),e.undoManager.add();else if(p)if(e.getParam("twExoticMarkdownEditor",!1)){var o="";if("true"==$(".mce-themChecksIMAGE").attr("aria-checked"))var o="!";var n=t.title?' "'+t.title+'"':"";e.insertContent(o+"["+y.encode(C.text).trim()+"]("+t.href+n+") ")}else e.insertContent(y.createHTML("a",t,y.encode(C.text)));else e.execCommand("mceInsertLink",!1,t)}var a;return C=tinymce.extend(C,t.data),(a=C.href)?a.indexOf("@")>0&&-1==a.indexOf("//")&&-1==a.indexOf("mailto:")?void o("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(e){e&&(a="mailto:"+a),n()}):e.settings.link_assume_external_targets&&!/^\w+:/i.test(a)||!e.settings.link_assume_external_targets&&/^\s*www[\.|\d\.]/i.test(a)?void o("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(e){e&&(a="http://"+a),n()}):void n():void e.execCommand("unlink")}})}}e.on("init change",function(){e.getParam("modxMagicHoverLinkSettings",{}).stripMODXurl;e.getParam("modxMagicHoverLinkSettings",{}).stripMODXurl!==!1&&$(e.getBody()).find("a").each(function(){var e=$(this).attr("href");e&&e.indexOf("[[~")>-1&&e.indexOf("]]")>-1&&(split1=e.split("[[~"),split2=split1[1].split("]]"),e="[[~"+split2[0]+"]]",$(this).attr({href:e,"data-mce-href":e}))})}),e.on("DblClick",function(t){e.getParam("tinymceBubbleBar",!1)||("IMG"==t.target.nodeName&&e.execCommand("mceImage",!0),"A"==t.target.nodeName&&e.execCommand("mceLink",!0))}),twExoticMarkdownEditorIcon="link",twExoticMarkdownEditorIText="Insert/edit link",e.getParam("twExoticMarkdownEditor",!1)&&(twExoticMarkdownEditorIcon="browse",twExoticMarkdownEditorIText="Markdown Link/Image"),e.addButton("link",{icon:twExoticMarkdownEditorIcon,tooltip:twExoticMarkdownEditorIText,shortcut:"Meta+K",onclick:t(n),stateSelector:"a[href]"}),e.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"}),e.addShortcut("Meta+K","",t(n)),e.addCommand("mceLink",t(n)),e.addCommand("modxMagicHoverLink",t(n)),this.showDialog=n,e.addMenuItem("link",{icon:twExoticMarkdownEditorIcon,text:twExoticMarkdownEditorIText,shortcut:"Meta+K",onclick:t(n),stateSelector:"a[href]",context:"insert",prependToContext:!0})});var mainExotic='<style id=mainExotic>.twExoticMarkdownEditor:before {display: block;content: "markdown";position: absolute;top: 2px;right: 5px;font-style: italic;font-size: 10px;background: #F2F2F2;padding: 1px 2px;border-radius: 4px;color: #2F4150;}.twExoticMarkdownEditor:hover:before{opacity:0.3;}</style>';tinymce.PluginManager.add("twExoticMarkdownEditor",function(e){e.on("BeforeExecCommand",function(e){return"twPreCodeManager"!=e.command&&"SelectAll"!=e.command&&"undo"!=e.command&&"redo"!=e.command&&"Undo"!=e.command&&"Redo"!=e.command&&"mceInsertContent"!=e.command&&"InsertLineBreak"!=e.command&&"Delete"!=e.command&&"mceSave"!=e.command?(e.preventDefault(),!1):void 0}),e.on("BeforeSetContent",function(t){e.settings.forced_root_block="p",e.settings.force_p_newlines=!0,e.settings.force_br_newlines=!1,e.settings.valid_elements="p",e.settings.unMarkedContent=getMyFootMarks(t.content)}),e.on("LoadContent",function(){$(e.getBody()).hasClass(e.getParam("twExoticMarkdownEditorSettings",{}).skipClass)||e.setContent(e.settings.unMarkedContent,{format:"raw"}),e.getParam("twExoticMarkdownEditorSettings",{}).removeClasses&&$(e.getBody()).removeClass(e.getParam("twExoticMarkdownEditorSettings",{}).removeClasses)}),e.on("init",function(){e.settings.twExoticMarkdownEditor=!0,e.getParam("twExoticMarkdownEditorSettings",{}).addAttr!==!1&&$(e.getBody()).attr("markdown",1),e.getParam("twExoticMarkdownEditorSettings",{}).addClass!==!1&&($(e.getBody()).addClass("twExoticMarkdownEditor"),$(e.getBody()).parents("html").find("head #mainExotic").length||$(e.getBody()).parents("html").find("head").append(mainExotic))}),e.on("keyup",function(t){t.shiftKey&&13==t.which&&(t.preventDefault(),e.insertContent("<p><br data-mce-bogus=1></p><p><br data-mce-bogus=1></p>"))}),e.on("SaveContent",function(t){e.isHidden()&&e.windowManager.alert("Please do not save while in hidden mode",function(){e.show()}),t.content=saveMyFootMarks(t.content)}),e.on("PastePreProcess",function(e){var t=e.content.replace(/  /g," &nbsp;"),o="",n=t.split("\n");$.each(n,function(e,t){o+=t?"<p>"+t+"</p>":"<p><br data-mce-bogus=1></p><p><br data-mce-bogus=1></p>"});var a=o.replace(/(?:&amp;gt;|&gt;)/g,">").replace(/(?:&amp;)/g,"&");e.content=a}),e.shortcuts.add("ctrl+b","",function(){makeMyFootMarks(e,"**","BOLD","** ")}),e.shortcuts.add("meta+b","",function(){makeMyFootMarks(e,"**","BOLD","** ")}),e.shortcuts.add("ctrl+i","",function(){makeMyFootMarks(e,"_","ITALIC","_ ")}),e.shortcuts.add("meta+i","",function(){makeMyFootMarks(e,"_","ITALIC","_ ")}),e.addButton("boldMD",{icon:"bold",tooltip:"Insert/Make Bold (ctrl+b)",onclick:function(){makeMyFootMarks(e,"**","BOLD","** ")}}),e.addButton("italicMD",{icon:"italic",tooltip:"Insert/Make Italic (ctrl+i)",onclick:function(){makeMyFootMarks(e,"_","ITALIC","_ ")}}),e.addButton("linkMD",{icon:"link",tooltip:"Insert/Make Link",onclick:function(){makeMyFootMarks(e,"[","LINK_TEXT","](http://link.com) ")}}),e.addButton("imageMD",{icon:"image",tooltip:"Insert/Make Image",onclick:function(){makeMyFootMarks(e,"![","IMAGE_ALT",'](image.jpg "TOOL_TIP") ')}}),e.addButton("blockquoteMD",{icon:"blockquote",tooltip:"Insert/Make Blockquote",onclick:function(){makeMyFootMarks(e,"<p><br data-mce-bogus=1></p><p>>","QUOTE","</p><p><br data-mce-bogus=1></p>")}}),e.addButton("codeMD",{icon:"code",tooltip:"Insert/Make Pre/Code",onclick:function(){makeMyFootMarks(e,"<p><br data-mce-bogus=1></p><p>```language-<p>","CODE","</p><p>```</p><p><br data-mce-bogus=1></p>")}}),e.addButton("numlistMD",{icon:"numlist",tooltip:"Insert/Make Number List",onclick:function(){makeMyFootMarks(e,"<p><br data-mce-bogus=1></p><p>1. ","ITEM_ONE","</p><p>2. ITEM_TWO</p><p>3. ITEM_THREE</p><p><br data-mce-bogus=1></p>")}}),e.addButton("bullistMD",{icon:"bullist",tooltip:"Insert/Make Bullet List",onclick:function(){makeMyFootMarks(e,"<p><br data-mce-bogus=1></p><p>+ ","ITEM_ONE","</p><p>+ ITEM_TWO</p><p>+ ITEM_THREE</p><p><br data-mce-bogus=1></p>")}}),e.addButton("tableMD",{icon:"table",tooltip:"Generate Markdown Tables (external link)",onclick:function(){window.open("http://www.tablesgenerator.com/markdown_tables")}}),e.addMenuItem("boldMD",{icon:"bold",text:"Insert/Make Bold",onclick:function(){makeMyFootMarks(e,"**","BOLD","** ")}}),e.addMenuItem("italicMD",{icon:"italic",text:"Insert/Make Italic",onclick:function(){makeMyFootMarks(e,"_","ITALIC","_ ")}}),e.addMenuItem("linkMD",{icon:"link",text:"Insert/Make Link",onclick:function(){makeMyFootMarks(e,"[","LINK_TEXT","](http://link.com) ")}}),e.addMenuItem("imageMD",{icon:"image",text:"Insert/Make Image",onclick:function(){makeMyFootMarks(e,"![","IMAGE_ALT",'](image.jpg "TOOL_TIP") ')}}),e.addMenuItem("blockquoteMD",{icon:"blockquote",text:"Insert/Make Blockquote",onclick:function(){makeMyFootMarks(e,"<p><br data-mce-bogus=1></p><p>>","QUOTE","</p><p><br data-mce-bogus=1></p>")}}),e.addMenuItem("codeMD",{icon:"code",text:"Insert/Make Pre/Code",onclick:function(){makeMyFootMarks(e,"<p><br data-mce-bogus=1></p><p>```language-</p><p>","CODE","</p><p>```</p><p><br data-mce-bogus=1></p>")}}),e.addMenuItem("numlistMD",{icon:"numlist",text:"Insert/Make Number List",onclick:function(){makeMyFootMarks(e,"<p><br data-mce-bogus=1></p><p>+ ","ITEM_ONE","</p><p>+ ITEM_TWO</p><p>+ ITEM_THREE</p><p><br data-mce-bogus=1></p>")}}),e.addMenuItem("bullistMD",{icon:"bullist",text:"Insert/Make Bullet List",onclick:function(){makeMyFootMarks(e,"<p><br data-mce-bogus=1></p><p>+ ","ITEM_ONE","</p><p>+ ITEM_TWO</p><p>+ ITEM_THREE</p><p><br data-mce-bogus=1></p>")}}),e.addMenuItem("tableMD",{icon:"table",text:"Tables (external link)",onclick:function(){window.open("http://www.tablesgenerator.com/markdown_tables")}})}),codeMirrorInnerInitRTE=function(e){var t={mode:"htmlmixed",theme:"",indentOnInit:!0,lineNumbers:!0,lineWrapping:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],indentUnit:1,tabSize:1,matchBrackets:!0,styleActiveLine:!0,autoCloseTags:!0,showTrailingSpace:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-F":"findPersistent",F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)},"Ctrl-Q":function(e){e.foldCode(e.getCursor())}}},o=$.extend({},t,e);return o},tinymce.PluginManager.add("twCodeMirror",function(e){function t(o){if(1==o)popCode(e.id);else if(0==o){var n=e.getParam("twCodeMirrorSettings",{}).twInlineWidth||"auto",a=e.getParam("twCodeMirrorSettings",{}).twInlineHeight||250;if(e.getParam("inline"))var i=e.id;else var i=e.getContainer().id;if($("#"+i).before("<div style=dispaly:none; class='coder "+e.id+"' data-origin="+e.id+"><span type=button onclick='killCode(\""+e.id+"\",1)' class='mce-close-button mce-reset'  title='Close this CodeMirror'><i class='mce-ico mce-i-remove'></i></span><textarea class='codeT' id='codeT"+e.id+"'>"+e.getContent()+"</textarea>"),$(".coder."+e.id).css({width:n,height:a}).fadeIn(),window["codeT"+e.id]=CodeMirror.fromTextArea(document.getElementById("codeT"+e.id),codeMirrorInnerInitRTE(e.getParam("twCodeMirrorSettings",{}))),e.getParam("twCodeMirrorSettings",{}).twFontSize)var r=e.getParam("twCodeMirrorSettings").twFontSize;else var r=15;$(".coder."+e.id+" .CodeMirror").css("font-size",r),window["codeT"+e.id].refresh(),"undefined"!=typeof emmetCodeMirror&&emmetCodeMirror(window["codeT"+e.id]),codeMirrorSetContentsilent=!1,window["codeT"+e.id].on("keyup",function(){codeMirrorSetContentsilent||e.setContent(window["codeT"+e.id].getValue())}),e.on("keyup",function(){codeMirrorSetContentsilent=!0,window["codeT"+e.id].getDoc().setValue(e.getContent()),codeMirrorSetContentsilent=!1}),0!==e.getParam("twCodeMirrorSettings",{}).twPopped&&popCode(e.id)}else $(".coder."+e.id).length?popCode(e.id):t(0)}function o(o){var n='<style id="mainCSScodeMIrror">.x-window-body{overflow-x:hidden!important;}.codeT,.coder{position:relative}.mce-popCode .mce-title{text-align:center;} .mce-popCode .mce-close-button{display:none;}.CodeMirror{text-align:left!important}.cm-trailingspace{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAYAAAB/qH1jAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QUXCToH00Y1UgAAACFJREFUCNdjPMDBUc/AwNDAAAFMTAwMDA0OP34wQgX/AQBYgwYEx4f9lQAAAABJRU5ErkJggg==);background-position:bottom left;background-repeat:repeat-x}.coder > .mce-close-button{position:absolute;top:-18px;right:0;cursor: pointer;background: #FFF;margin: 0 19px -4px 0;text-align: center;border-radius: 5px 5px 0 0;padding: 2px;box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4);}.mce-popCodeMirror,.mce-popCodeMirror .mce-container-body{width:inherit!important}.coder .CodeMirror{box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4); width:inherit;height:inherit;}.mce-popCode .CodeMirror{box-shadow:none;width:98.8%!important;}.coder > .mce-close-button > .mce-ico{font-size:15px; color:#000;}</style>';if($("#mainCSScodeMIrror").length||$("head").append(n),"undefined"==typeof CodeMirror){var a=e.getParam("twCodeMirrorSettings",{}).twCodeMirrorCDNbase||"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.14.2/",i=new tinymce.dom.ScriptLoader,r=new tinymce.dom.ScriptLoader;tinymce.DOM.loadCSS(a+"codemirror.min.css"),tinymce.DOM.loadCSS(a+"addon/dialog/dialog.css"),tinymce.DOM.loadCSS(a+"addon/search/matchesonscrollbar.css"),tinymce.DOM.loadCSS(a+"addon/display/fullscreen.css"),tinymce.DOM.loadCSS(a+"addon/fold/foldgutter.css"),e.getParam("twCodeMirrorSettings",{}).theme&&tinymce.DOM.loadCSS(a+"theme/"+e.getParam("twCodeMirrorSettings").theme+".css"),i.add(a+"codemirror.min.js"),i.loadQueue(function(){"undefined"==typeof emmetCodeMirror&&e.getParam("twCodeMirrorSettings",{}).twEmmetUrl&&r.add(e.getParam("twCodeMirrorSettings").twEmmetUrl),r.add(a+"addon/wrap/hardwrap.min.js"),r.add(a+"addon/selection/active-line.min.js"),r.add(a+"addon/search/searchcursor.min.js"),r.add(a+"addon/scroll/annotatescrollbar.js"),r.add(a+"addon/search/matchesonscrollbar.js"),r.add(a+"addon/search/jump-to-line.min.js"),r.add(a+"addon/search/search.min.js"),r.add(a+"addon/dialog/dialog.min.js"),r.add(a+"addon/hint/show-hint.min.js"),r.add(a+"addon/hint/html-hint.min.js"),r.add(a+"addon/hint/xml-hint.min.js"),r.add(a+"addon/edit/closetag.min.js"),r.add(a+"addon/edit/trailingspace.min.js"),r.add(a+"addon/display/fullscreen.js"),r.add(a+"addon/fold/foldcode.js"),r.add(a+"addon/fold/foldgutter.js"),r.add(a+"addon/fold/brace-fold.js"),r.add(a+"addon/fold/xml-fold.js"),r.add(a+"addon/fold/comment-fold.js"),r.add(a+"addon/edit/matchbrackets.min.js"),r.add(a+"mode/htmlmixed/htmlmixed.min.js"),r.add(a+"mode/javascript/javascript.min.js"),r.add(a+"mode/xml/xml.min.js"),r.add(a+"mode/css/css.min.js"),r.loadQueue(function(){setTimeout(function(){t(o)},500)})})}else t(o)}$("#"+e.id);e.addButton("code",{type:"button",classes:"twCoderM",icon:"code",tooltip:"CodeMirror",onclick:function(){$(".mce-popCodeMirror.mce-"+e.id).length||o()}}),e.addMenuItem("code",{icon:"code",text:"CodeMirror",onclick:function(){$(".mce-popCodeMirror.mce-"+e.id).length||o()}})}),aceInnerInitRTE=function(e){var t={mode:"ace/mode/html",wrap:"free",displayIndentGuides:!0,scrollPastEnd:!1,showPrintMargin:!1,fontSize:15,tabSize:2},o=$.extend({},t,e);return o},tinymce.PluginManager.add("twAceEditor",function(e){function t(o){if(1==o)popCodeAce(e.id);else if(0==o){var n=e.getParam("twAceEditorSettings",{}).twInlineWidth||"auto",a=e.getParam("twAceEditorSettings",{}).twInlineHeight||250;if(e.getParam("inline"))var i=e.id;else var i=e.getContainer().id;$("#"+i).before("<div style=dispaly:none; class='coder "+e.id+"' data-origin="+e.id+"><span type=button onclick='killCodeAce(\""+e.id+"\",1)' class='mce-close-button mce-reset'  title='Close this Ace'><i class='mce-ico mce-i-remove'></i></span><textarea class='codeT' id='codeT"+e.id+"'>"+e.getContent()+"</textarea>"),$(".coder."+e.id).css({width:n,height:a}).fadeIn(),window["codeT"+e.id]=ace.edit("codeT"+e.id),window["codeT"+e.id].$blockScrolling=1/0,("undefined"!=typeof emmetForAceIsLoaded||e.getParam("twAceEditorSettings",{}).enableEmmet&&e.getParam("twAceEditorSettings",{}).twEmmetUrl)&&window["codeT"+e.id].setOption("enableEmmet",!0),window["codeT"+e.id].setOptions(aceInnerInitRTE(e.getParam("twAceEditorSettings",{}))),window["codeT"+e.id].resize(),aceSetContentsilent=!1,window["codeT"+e.id].on("change",function(){aceSetContentsilent||e.setContent(window["codeT"+e.id].getValue())}),e.on("keyup ",function(){aceSetContentsilent=!0,window["codeT"+e.id].setValue(e.getContent()),aceSetContentsilent=!1}),0!==e.getParam("twAceEditorSettings",{}).twPopped&&popCodeAce(e.id)}else $(".coder."+e.id).length?popCodeAce(e.id):t(0)}function o(o){function n(o){var n='<style id="mainCSSAceEditor">.x-window-body{overflow-x:hidden!important;}.codeT,.coder{position:relative}.codeT{width:100%;resize:vertical;color:#000;min-height:300px;margin:0 auto}.mce-popCode .mce-title{text-align:center;} .mce-popCode .mce-close-button{display:none;}.ace_editor{text-align:left!important}.mce-popCode .ace_editor{height:inherit;width:99.5%!important;}.coder .ace_editor{height:inherit;width:inherit;}.mce-popAceEditor,.mce-popAceEditor .mce-container-body{width:inherit!important}.coder > .mce-close-button{position:absolute;top:-18px;right:0;cursor: pointer;background: #FFF;margin: 0 19px -4px 0;text-align: center;border-radius: 5px 5px 0 0;padding: 2px;box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4);}.coder .ace_editor{box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4)}.mce-popCode .ace_editor{box-shadow:none;}.coder > .mce-close-button > .mce-ico{font-size:15px; color:#000;}</style>';if($("#mainCSSAceEditor").length||0===e.getParam("twAceEditorSettings",{}).twLoadCSS||$("head").append(n),"undefined"==typeof ace){var a=e.getParam("twAceEditorSettings",{}).twAceEditorCDNbase||"https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/",i=new tinymce.dom.ScriptLoader;i.add(a+"ace.js"),"undefined"==typeof emmetForAceIsLoaded&&e.getParam("twAceEditorSettings",{}).twEmmetUrl&&(i.add(e.getParam("twAceEditorSettings",{}).twEmmetUrl),i.add(a+"ext-emmet.js")),i.loadQueue(function(){setTimeout(function(){t(o)},500)})}else t(o)}var o=o;tinymce.activeEditor.dom.select("pre").length||tinymce.activeEditor.dom.select("code").length?tinymce.activeEditor.windowManager.confirm("twAceEditor.js: PRE/CODE entitized HTML is not yet supported, proceed?",function(e){e&&n(o)}):n(o)}$("#"+e.id);e.addButton("code",{type:"button",classes:"twAceE",icon:"code",tooltip:"Ace Editor",onclick:function(){$(".mce-popAceEditor.mce-"+e.id).length||o()}}),e.addMenuItem("code",{icon:"code",text:"Ace Editor",onclick:function(){$(".mce-popAceEditor.mce-"+e.id).length||o()}})});