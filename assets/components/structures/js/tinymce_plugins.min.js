function changeUploadPath(e){function t(){var t=function(t,n){"ok"==t&&n&&(e.settings.tbRapidImageSettings.uploadUrl=n)};Ext.MessageBox.prompt("UPLOAD URL","<p style=text-align:center;>Changes won't affect newly added editors<br><b>SCRIPT</b>&nbsp;&nbsp;"+window["tinyBlocksUploadScriptUrl_"+e.id]+"</p><br><b>PATH</b><br>&nbsp;&nbsp;<b>Original</b>&nbsp;&nbsp;"+window["tinyBlocksUploadPath_"+e.id]+"<br>&nbsp;&nbsp;<b>Current</b>&nbsp;&nbsp;"+e.settings.tbRapidImageSettings.uploadPath+"<br><br><b>URL</b><br>&nbsp;&nbsp;<b>Original:</b>&nbsp;&nbsp;"+window["tinyBlocksUploadUrl_"+e.id]+"<br>&nbsp;&nbsp;<b>Current</b>&nbsp;&nbsp;"+e.settings.tbRapidImageSettings.uploadUrl+"<br><br><div style=text-align:center;><b>ENTER NEW <u>URL</u></b> (web address of Path)</div>",t)}if(e.getParam("tbRapidImageSettings",{}).uploadScriptUrl&&e.getParam("tbRapidImageSettings",{}).uploadPath&&e.getParam("tbRapidImageSettings",{}).uploadUrl){var n=function(n,o){"ok"==n&&o&&(e.settings.tbRapidImageSettings.uploadPath=o,t())};Ext.MessageBox.prompt("UPLOAD PATH","<p style=text-align:center;>Changes won't affect newly added editors<br><b>SCRIPT</b>&nbsp;&nbsp;"+window["tinyBlocksUploadScriptUrl_"+e.id]+"</p><br><b>PATH</b><br>&nbsp;&nbsp;<b>Original</b>&nbsp;&nbsp;"+window["tinyBlocksUploadPath_"+e.id]+"<br>&nbsp;&nbsp;<b>Current</b>&nbsp;&nbsp;"+e.settings.tbRapidImageSettings.uploadPath+"<br><br><b>URL</b><br>&nbsp;&nbsp;<b>Original:</b>&nbsp;&nbsp;"+window["tinyBlocksUploadUrl_"+e.id]+"<br>&nbsp;&nbsp;<b>Current</b>&nbsp;&nbsp;"+e.settings.tbRapidImageSettings.uploadUrl+"<br><br><div style=text-align:center;><b>ENTER NEW <u>PATH</u></b> (<i>relative</i> to Script)</div>",n)}else Ext.MessageBox.alert("Alert!","Please check your TinyMCE init tbRapidImageSettings")}function fineTuneBarPosition(e,t,n){var o=t.getBoundingClientRect(),a=(o.left+o.right)/2,i=n.outerHeight(),r=n.outerWidth(),c=r/2,d=0,s=d-c,l=$(window).innerWidth(),m=($(window).height(),document.body.scrollTop||document.documentElement.scrollTop),p=10,u=e.getParam("bubbleBarCSSstyle")?e.getParam("bubbleBarCSSstyle"):"";if(e.getParam("inline")){var g=($("#"+e.id),o.top+window.pageYOffset-i-p);if(o.top<n.height())var g=o.top+window.pageYOffset+i}else{var g=($(e.getContainer()),o.top-i-p);if(o.top<m||m>g)var g=o.bottom+p}if(c>a)var h=s+c;else if(c>l-a)var h=l+s-c-p;else var h=s+a+p;n.addClass("mce-tbActiveBar").attr("style",u).css({top:g,left:h})}function bubbleUp(e,t){if("addClass"==t){if(e.getParam("inline"))var n=$(e.getParam("fixed_toolbar_container"));else var n=$(e.getContainer()).find(".mce-toolbar-grp");n.addClass("mce-bubbleBar")}if("addClassSticky"==t){if(e.getParam("inline"))var n=$(e.getParam("fixed_toolbar_container"));else var n=$(e.getContainer()).find(".mce-toolbar-grp");n.hasClass("mce-bubbleBarSticky")?n.removeClass("mce-bubbleBarSticky"):n.addClass("mce-bubbleBarSticky")}setTimeout(function(){var t=e.selection.getRng(!0),n=""+t;if(e.getParam("inline"))var o=$(e.getParam("fixed_toolbar_container"));else var o=$(e.getContainer()).find(".mce-toolbar-grp");""!==n.trim()?fineTuneBarPosition(e,t,o):$(".mce-bubbleBar").removeClass("mce-tbActiveBar")},100)}function wordCount(e){var t=e.getParam("wordcount_countregex",/[\w\u2019\x27\-\u00C0-\u1FFF]+/g),n=e.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\x27\x22_+=\\\/\-]*/g),o=e.getContent({format:"raw"}),a=e.selection.getContent(),i=0,r=0,c=0,d=0;if(o){if(a&&""!==a){var d=a.length,s=a.replace(/\.\.\./g," ").replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," ").replace(/(\w+)(&#?[a-z0-9]+;)+(\w+)/i,"$1$3").replace(/&.+?;/g," ").replace(n,""),l=s.match(t);l&&(c=l.length)}var m=o.replace(/\.\.\./g," ").replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," ").replace(/(\w+)(&#?[a-z0-9]+;)+(\w+)/i,"$1$3").replace(/&.+?;/g," ").replace(n,""),p=m.match(t),u=$(e.getBody()).text().length;p&&(i=p.length),u&&(r=u)}$(".mce-npSelCount span.mce-text").text("Selected Words: "+c+", Characters: "+d),$(".mce-npCount span.mce-text").text("Total Word Count: "+i),$(".mce-npCSCount span.mce-text").text("Total Characters (+spaces): "+r),$(".mce-npPCount span.mce-text").text("Total Paragraphs: "+$(e.getBody()).find("p").length)}function twPreCodeManagerPREcssInit(e){var t="[twprecodemanagerprecss]{position:relative!important;max-height:100px!important;box-shadow:1px 2px 3px 3px grey;overflow:hidden!important;padding:10px!important}[twprecodemanagerprecss]:before{content:'';display:block!important;height:10px!important;position:absolute!important;bottom:-11px;width:90%;margin:auto;background:#fff;box-shadow:4px 12px 20px 20px #FBFBFB;left:0;right:0}[twprecodemanagerprecss][data-mce-selected]{outline:0!important;box-shadow:1px 2px 3px 3px #3B3A7D!important}";if(e.getParam("inline"))$("#twPreCodeManagerPREcss").length||$("head").append('<style id="twPreCodeManagerPREcss">'+t+"</style>");else{var n=$("#"+e.id+"_ifr").contents().find("head");n.find("#twPreCodeManagerPREcss").length||n.append('<style id="twPreCodeManagerPREcss">'+t+"</style>")}}function twPreCodeManagerInputBox(e,t,n){function o(e,t,n){var e=tinymce.activeEditor;e.undoManager.transact(function(){var o=a(e);if(tinymce.activeEditor.getParam("twPreCodeManagerSettings",{}).protectSquareBracket){var i=e.getParam("twPreCodeManagerSettings",{}).protectSquareBracketXter||"*";n=e.dom.encode(n.replace(/(?:\[\[)/g,"["+i+"["))}else n=e.dom.encode(n);o&&"PRE"==o.nodeName&&!e.getParam("twExoticMarkdownEditor",!1)?(o.setAttribute("class",$(".mce-preLanguageTextBox").val()),o.children[0]?(o.children[0].setAttribute("class",$(".mce-codeLanguageTextBox").val()),o.children[0].innerHTML=n):o.innerHTML=n,e.selection.select(o)):o&&"CODE"==o.nodeName&&"PRE"!==o.parentNode.nodeName&&!e.getParam("twExoticMarkdownEditor",!1)?(o.setAttribute("class",$(".mce-codeLanguageTextBox").val()),o.innerHTML=n,e.selection.select(o)):e.getParam("twExoticMarkdownEditor",!1)?e.insertContent("<br>```"+t+"<br>"+n.replace(/ /g,"&nbsp;").replace(/(?:\r\n|\r|\n)/g,"<br />")+"<br>```<br><br>"):(e.insertContent('<pre id="__new" class='+t+"><code class="+t+">"+n+"</code></pre>"),e.selection.select(tinymce.activeEditor.$("#__new").removeAttr("id")[0]))})}function a(){var e=tinymce.activeEditor.selection.getNode();return e&&"CODE"==e.nodeName&&"PRE"!==e.parentNode.nodeName||"PRE"==e.nodeName?e:null}function i(e){var t=a(e);return t?"PRE"==t.nodeName&&t.children[0]?t.firstChild.innerText:"PRE"!=t.nodeName||t.children[0]?"CODE"==t.nodeName&&"PRE"!==t.parentNode.nodeName?t.innerText:void 0:t.innerText:""}function r(e){var t,n=a(e);return n&&"PRE"==n.nodeName?(t=n.className,t?t:""):""}function c(e){var t,n=a(e);return n&&"CODE"==n.nodeName&&"PRE"!==n.parentNode.nodeName?(t=n.className,t?t:""):n&&n.firstChild?(t=n.firstChild.className,t?t:""):""}var d=[{text:"Library Presets",value:""},{text:"Highlight",value:"highlight"},{text:"Prism",value:"language-"},{text:"Prettyprint",value:"prettyprint"}],s=[{text:"Language Names",value:""},{text:"CSS",value:"css"},{text:"HTML",value:"markup"},{text:"JavaScript",value:"javascript"},{text:"JSON",value:"json"},{text:"PHP",value:"php"},{text:"--------------",value:"",disabled:!0},{text:"ABAP",value:"abap"},{text:"ActionScript",value:"actionscript"},{text:"Apache Configuration",value:"apacheconf"},{text:"APL",value:"apl"},{text:"AppleScript",value:"applescript"},{text:"AsciiDoc",value:"asciidoc"},{text:"ASP.NET (C#)",value:"aspnet"},{text:"AutoHotkey",value:"autohotkey"},{text:"AutoIt",value:"autoit"},{text:"BASIC",value:"basic"},{text:"C-like",value:"clike"},{text:"CoffeeScript",value:"coffeescript"},{text:"C++",value:"cpp"},{text:"C#",value:"csharp"},{text:"CSS",value:"css"},{text:"CSS Extras",value:"css-extras"},{text:"F#",value:"fsharp"},{text:"GLSL",value:"glsl"},{text:"HTML",value:"markup"},{text:"HTTP",value:"http"},{text:"Inform 7",value:"inform7"},{text:"JavaScript",value:"javascript"},{text:"JSON",value:"json"},{text:"React JSX",value:"jsx"},{text:"LaTeX",value:"latex"},{text:"LOLCODE",value:"lolcode"},{text:"MathML",value:"mathml"},{text:"MATLAB",value:"matlab"},{text:"MEL",value:"mel"},{text:"NASM",value:"nasm"},{text:"nginx",value:"nginx"},{text:"NSIS",value:"nsis"},{text:"Objective-C",value:"objectivec"},{text:"OCaml",value:"ocaml"},{text:"PARI/GP",value:"parigp"},{text:"PHP",value:"php"},{text:"PHP Extras",value:"php-extras"},{text:"PowerShell",value:"powershell"},{text:"reST (reStructuredText)",value:"rest"},{text:"SAS",value:"sas"},{text:"Sass (Sass)",value:"sass"},{text:"Sass (Scss)",value:"scss"},{text:"SQL",value:"sql"},{text:"SVG",value:"svg"},{text:"TypeScript",value:"typescript"},{text:"VHDL",value:"vhdl"},{text:"vim",value:"vim"},{text:"Wiki markup",value:"wiki"},{text:"XML",value:"xml"},{text:"YAML",value:"yaml"}];return{open:function(e){tinymce.activeEditor.windowManager.open({title:"<pre><code> Manager",width:t,height:n,layout:"fit",body:[{type:"textbox",tooltip:"Enter classes directly",name:"language",label:"PRE classes",maxWidth:200,value:r(e),classes:"preLanguageTextBox",onPostRender:function(){var e=tinymce.activeEditor.selection.getNode();e&&"CODE"==e.nodeName&&"PRE"!==e.parentNode.nodeName&&$(".mce-preLanguageTextBox").parent().parent().hide()}},{type:"textbox",tooltip:"Enter classes directly",label:"CODE classes",maxWidth:200,value:c(e),classes:"codeLanguageTextBox",onPostRender:function(){var e=tinymce.activeEditor.selection.getNode();e&&"PRE"==e.nodeName&&!e.children[0]&&tinymce.activeEditor.getParam("twPreCodeManagerSettings",{}).managerForceCODEtag&&(e.innerHTML="<code></code>"),(e&&"PRE"==e.nodeName&&!e.children[0]||tinymce.activeEditor.getParam("twExoticMarkdownEditor",!1))&&$(".mce-codeLanguageTextBox").parent().parent().hide()}},{type:"listbox",label:"Libraries",maxWidth:200,value:r(e)||c(e),values:d,classes:"libListBox",onselect:function(){var e=$(".mce-preLanguageTextBox")[0].value?$(".mce-preLanguageTextBox")[0].value+" ":"";$(".mce-preLanguageTextBox").length&&($(".mce-preLanguageTextBox")[0].value=e+this.value());var t=$(".mce-codeLanguageTextBox")[0].value?$(".mce-codeLanguageTextBox")[0].value+" ":"";$(".mce-codeLanguageTextBox")[0].value=t+this.value()}},{type:"listbox",label:"Languages",maxWidth:200,value:r(e)||c(e),values:s,classes:"languageListBox",onselect:function(){var e=$(".mce-preLanguageTextBox")[0].value?$(".mce-preLanguageTextBox")[0].value+" ":"";$(".mce-preLanguageTextBox").length&&($(".mce-preLanguageTextBox")[0].value=e+this.value());var t=$(".mce-codeLanguageTextBox")[0].value?$(".mce-codeLanguageTextBox")[0].value+" ":"";$(".mce-codeLanguageTextBox")[0].value=t+this.value()}},{type:"textbox",name:"code",multiline:!0,spellcheck:!1,ariaLabel:"Code view",flex:1,style:"direction: ltr; text-align: left",value:i(e),classes:"codeTextarea",onPostRender:function(){$(".mce-codeTextarea").attr("placeholder","Just paste your source code. It will automatically and safely be entitized. All Markdown is left as is")}}],onSubmit:function(t){if($(".mce-codeTextarea").val()){o(e,t.data.language,t.data.code);{tinymce.activeEditor.selection.getNode()}}}})}}}function transformMarks(e,t){if(e.getParam("inline"))var n=$("textarea[name="+t+"]").val();else var n=e.getElement().value;var o=new showdown.Converter;document.getElementById("codeT"+t)&&(targetArea=document.getElementById("codeT"+t),text=n,data=o.makeHtml(text),targetArea.innerHTML=data,tinymce.activeEditor.getParam("twShowdownSettings",{}).twEnableMathJax!==!1&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,"codeT"+t]))}function popShowdown(e,t,n,o,a){var e=$(e),i=e.data("origin"),r=$("<div>").hide().insertBefore(e);tinymce.activeEditor.windowManager.open({title:t,width:n,height:o,classes:"popCode "+i,onclose:function(e){e.preventDefault;0==twShowdownKillCodeSecure&&killCodeShowdown(i,1)},items:[{classes:"popShowdown "+i,type:"container",onPostRender:function(){twShowdownKillCode=0,twShowdownKillCodeSecure=0,$(e).appendTo(".mce-popShowdown.mce-"+i+" > .mce-container-body"),setTimeout(function(){$(".mce-popCode.mce-"+i).removeClass("mce-container").find("*").removeClass("mce-container"),$(".mce-popCode.mce-"+i+" .mce-close").addClass("mce-reset");var e=setInterval(function(){$(".mce-popShowdown.mce-"+i+" .showdown").length&&(transformMarks(tinymce.activeEditor,i),clearInterval(e));$(".codeT."+i).data("height");$("#codeT"+i+", .coderSNparent."+i).css({"max-width":n,height:o})},100)},100)}}],buttons:[{text:a,active:!0,onclick:function(){var t=$("#"+i).width(),n=$("#codeT"+i).data("height"),o=n-5;$(".coderSNparent."+i).css({"max-width":t,height:n}),$("#codeT"+i).css({"max-width":t,height:o}),r.replaceWith(e),twShowdownKillCode=0,twShowdownKillCodeSecure=1,tinymce.activeEditor.windowManager.close()}}]})}function killCodeShowdown(e,t){1==t&&($(".coderSNparent."+e).remove(),tinymce.activeEditor.windowManager.close())}function popCodeShowdown(e){var t=tinymce.get(e).getParam("twShowdownSettings",{}).twPoppedTitle||"Markdown / MathJax Preview",n=tinymce.get(e).getParam("twShowdownSettings",{}).twPoppedWidth||window.innerWidth/1.2,o=tinymce.get(e).getParam("twShowdownSettings",{}).twPoppedHeight||300,a=tinymce.get(e).getParam("twShowdownSettings",{}).twViewInlineButtonText||"View Inline",i=tinymce.get(e).getParam("twShowdownSettings",{}).twCloseButtonText||"Close",r=tinymce.get(e).getParam("twShowdownSettings",{}).twInlineWidth||"auto",c=tinymce.get(e).getParam("twShowdownSettings",{}).twInlineHeight||250;popShowdown(".coderSNparent."+e,t,n,o,a,i,r,c)}function saveMyFootMarks(e){var t=tinymce.html.Entities.decode(e.replace(/(?:<br>|<br \/>)/g,"\n").replace(/(&nbsp;)/g," ").replace(/(?:&amp;gt;|&gt;)/g,">"));return t}function getMyFootMarks(e){var t=tinymce.html.Entities.encodeAllRaw(e).replace(/  /g," &nbsp;").replace(/(?:\r\n|\r|\n)/g,"<br />").replace(/(?:&amp;gt;|&gt;)/g,">").replace(/(?:&amp;)/g,"&");return t}function makeMyFootMarks(e,t,n,o){var a=e.selection.getContent();""!==a.trim()&&(n=a.trim()),e.undoManager.transact(function(){e.selection.setContent(t+n+o)})}function popMirror(e,t,n,o,a,i,r,c){var e=$(e),d=e.data("origin"),s=$("<div>").hide().insertBefore(e);tinymce.activeEditor.windowManager.open({title:t,width:n,height:o,classes:"popCode "+d,onclose:function(e){e.preventDefault;0==twCodeMirrorKillCodeSecure&&killCode(d,1)},items:[{classes:"popCodeMirror "+d,type:"container",onPostRender:function(){twCodeMirrorKillCode=0,twCodeMirrorKillCodeSecure=0,$(e).appendTo(".mce-popCodeMirror.mce-"+d+" > .mce-container-body"),setTimeout(function(){$(".mce-popCode.mce-"+d).removeClass("mce-container").find("*").removeClass("mce-container"),$(".mce-popCode.mce-"+d+" .mce-close").addClass("mce-reset"),window["codeT"+d].refresh();var e=setInterval(function(){$(".mce-popCodeMirror.mce-"+d+" .CodeMirror").length&&($(".mce-popCodeMirror.mce-"+d+" .coder").css({width:n,height:o}),clearInterval(e))},100)},100)}}],buttons:[{text:a,active:!0,onclick:function(){$(".mce-popCodeMirror.mce-"+d+" .coder").css({width:r,height:c}),s.replaceWith(e),window["codeT"+d].refresh(),twCodeMirrorKillCode=0,twCodeMirrorKillCodeSecure=1,tinymce.activeEditor.windowManager.close()}}]})}function killCode(e,t){1==t&&(codeMirrorSetContentsilent=!0,$("#"+e).html(window["codeT"+e].getValue()),window["codeT"+e].toTextArea(),$(".coder."+e).remove(),tinymce.activeEditor.windowManager.close())}function popCode(e){var t=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twPoppedTitle||"CodeMirror HTML Source Code",n=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twPoppedWidth||window.innerWidth/1.2,o=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twPoppedHeight||300,a=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twViewInlineButtonText||"View Inline",i=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twCloseButtonText||"Close",r=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twInlineWidth||"auto",c=tinymce.get(e).getParam("twCodeMirrorSettings",{}).twInlineHeight||250;popMirror(".coder."+e,t,n,o,a,i,r,c)}function popAce(e,t,n,o,a,i,r,c){var e=$(e),d=e.data("origin"),s=$("<div>").hide().insertBefore(e);tinymce.activeEditor.windowManager.open({title:t,width:n,height:o,classes:"popCode "+d,onclose:function(e){e.preventDefault;0==twAceEditorKillCodeSecure&&killCodeAce(d,1)},items:[{classes:"popAceEditor "+d,type:"container",onPostRender:function(){twAceEditorKillCode=0,twAceEditorKillCodeSecure=0,$(e).appendTo(".mce-popAceEditor.mce-"+d+" > .mce-container-body"),setTimeout(function(){$(".mce-popCode.mce-"+d).removeClass("mce-container").find("*").removeClass("mce-container"),$(".mce-popCode.mce-"+d+" .mce-close").addClass("mce-reset"),window["codeT"+d].resize();var e=setInterval(function(){$(".mce-popAceEditor.mce-"+d+" .ace_editor").length&&($(".mce-popAceEditor.mce-"+d+" .coder").css({width:n,height:o}),clearInterval(e))},100)},100)}}],buttons:[{text:a,active:!0,onclick:function(){$(".mce-popAceEditor.mce-"+d+" .coder").css({width:r,height:c}),s.replaceWith(e),window["codeT"+d].resize(),twAceEditorKillCode=0,twAceEditorKillCodeSecure=1,tinymce.activeEditor.windowManager.close()}}]})}function killCodeAce(e,t){1==t&&(aceSetContentsilent=!0,$("#"+e).html(window["codeT"+e].getValue()),window["codeT"+e].remove(),$(".coder."+e).remove(),tinymce.activeEditor.windowManager.close())}function popCodeAce(e){var t=tinymce.get(e).getParam("twAceEditorSettings",{}).twPoppedTitle||"Ace HTML Source Code",n=tinymce.get(e).getParam("twAceEditorSettings",{}).twPoppedWidth||window.innerWidth/1.2,o=tinymce.get(e).getParam("twAceEditorSettings",{}).twPoppedHeight||300,a=tinymce.get(e).getParam("twAceEditorSettings",{}).twViewInlineButtonText||"View Inline",i=tinymce.get(e).getParam("twAceEditorSettings",{}).twCloseButtonText||"Close",r=tinymce.get(e).getParam("twAceEditorSettings",{}).twInlineWidth||"auto",c=tinymce.get(e).getParam("twAceEditorSettings",{}).twInlineHeight||250;popAce(".coder."+e,t,n,o,a,i,r,c)}tinymce.PluginManager.add("structures",function(e){function t(t){var n=$(e.getBody());if($(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img"))var o="img";else var o="pre";if(n.children(o).length&&$(e.getBody()).html(n.children(o+":first")),"click"==t){var a=e.dom.select(o);e.selection.select(a[0]),top.tinymce.activeEditor.windowManager.close(),setTimeout(function(){$(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img")?e.execCommand("mceImage",!0):e.execCommand("twPreCodeManager",!0)},100)}}e.on("init",function(){if(($(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img")||$(e.getBody()).hasClass("tb-tiny-dc"))&&$(e.getBody()).attr("contenteditable",!1),e.getParam("addClasses",{}).toParent&&$(e.getBody()).parent().addClass(e.getParam("addClasses",{}).toParent),e.getParam("addClasses",{}).toSelf&&$(e.getBody()).addClass(e.getParam("addClasses",{}).toSelf),e.getParam("tbRapidImageSettings",{})){var t=$(e.getBody()).find("img");t.each(function(){var e=$(this).attr("src"),t=e.substr(e.lastIndexOf("/")+1);$(this).attr("data-tb-rapid",t)})}e.getParam("tbRapidImageSettings",{}).uploadScriptUrl&&e.getParam("tbRapidImageSettings",{}).uploadPath&&e.getParam("tbRapidImageSettings",{}).uploadUrl&&(window["tinyBlocksUploadScriptUrl_"+e.id]=e.getParam("tbRapidImageSettings").uploadScriptUrl,window["tinyBlocksUploadPath_"+e.id]=e.getParam("tbRapidImageSettings").uploadPath,window["tinyBlocksUploadUrl_"+e.id]=e.getParam("tbRapidImageSettings").uploadUrl)}),e.on("LoadContent blur",function(){($(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img")||$(e.getBody()).hasClass("tb-tiny-dc"))&&t()}),e.on("click",function(){($(e.getBody()).hasClass("tb-tiny-im")||$(e.getBody()).hasClass("tb-tiny-img")||$(e.getBody()).hasClass("tb-tiny-dc"))&&t("click")}),e.addMenuItem("rapidImage",{icon:"upload",text:"Rapid Image Settings",onclick:function(){changeUploadPath(e)}})});var tinymceBubbleBarCSS=".mce-bubbleBar{position:absolute!important;z-index:999;border-radius:5px;box-shadow:0 2px 8px rgba(0,0,0,.75);opacity:0!important;visibility:hidden}.mce-bubbleBar.mce-tbActiveBar{opacity:.95!important;visibility:visible!important;animation:tinyBubble-pop-upwards 180ms forwards linear}.mce-bubbleBar.mce-bubbleBarSticky{visibility:visible!important;opacity:1!important;}@keyframes tinyBubble-pop-upwards{0%{opacity:0;transform:matrix(.97,0,0,1,0,12)}20%{opacity:.7;transform:matrix(.99,0,0,1,0,2)}40%{opacity:1;transform:matrix(1,0,0,1,0,-1)}100%{transform:matrix(1,0,0,1,0,0)}}";$("#tinymceBubbleBarCSS").length||$("head").append('<style id="tinymceBubbleBarCSS">'+tinymceBubbleBarCSS+"</style>"),tinymce.PluginManager.add("bubbleBar",function(e){e.addCommand("tinymceBubbleBar",function(){}),e.on("init",function(){bubbleUp(e,"addClass"),e.settings.tinymceBubbleBar=!0}),e.on("mouseup keyup",function(){bubbleUp(e)}),e.on("blur",function(){$(".mce-bubbleBar").removeClass("mce-tbActiveBar")}),e.on("focus mouseup keyup change",function(){wordCount(e)}),e.on("DblClick",function(t){"IMG"==t.target.nodeName&&e.execCommand("mceImage",!0),"A"==t.target.nodeName&&e.execCommand("mceLink",!0)}),e.addButton("bubbleBarOptionsButton",{type:"menubutton",text:"...",classes:e.id+" bubbleBarOptionsButton",tooltip:"tinymceBubbleBar options",autohide:!1,onclick:function(){setTimeout(function(){wordCount(e)},200)},onPostRender:function(){},menu:[{text:"Toggle Sticky",onclick:function(){bubbleUp(e,"addClassSticky")}},{text:"Total Word Count: 000000",classes:"npCount",menu:[{classes:"npCSCount",text:"Total Characters (+spaces): 0000000",onPostRender:function(){setTimeout(function(){wordCount(e)},200)}},{classes:"npPCount",text:"Total Paragraphs: 000000 "},{classes:"npSelCount",text:"Selected Words: 000, Characters: 0000"}]}]})}),tinymce.PluginManager.add("twPreCodeManager",function(e){e.on("init",function(){twPreCodeManagerPREcssInit(e)}),e.on("SetContent",function(){1==e.getParam("twPreCodeManagerSettings",{}).contentEditable||$(e.getBody()).find("pre").attr("contenteditable",!1),e.getParam("twPreCodeManagerSettings",{}).managerPREcss!==!1&&$(e.getBody()).find("pre").attr("twprecodemanagerprecss",1)}),e.addCommand("twPreCodeManager",function(){var t=e.getParam("twPreCodeManagerSettings",{}).managerWidth||window.innerWidth/1.4,n=e.getParam("twPreCodeManagerSettings",{}).managerHeight||window.innerHeight/1.5;twPreCodeManagerInputBox(e,t,n).open()}),e.addButton("twPreCodeManager",{icon:"codesample",cmd:"twPreCodeManager",title:"Insert/edit <pre><code>"}),e.addMenuItem("twPreCodeManager",{icon:"codesample",cmd:"twPreCodeManager",text:"Insert/edit <pre><code>"}),e.on("DblClick",function(t){("PRE"==t.target.nodeName||"CODE"==t.target.nodeName&&"PRE"==t.target.parentNode.nodeName||"CODE"==t.target.nodeName&&"PRE"!==t.target.parentNode.nodeName)&&e.execCommand("twPreCodeManager",!0)}),e.on("LoadContent",function(){e.getParam("twPreCodeManagerSettings",{}).protectSquareBracket&&$(e.getBody()).find("code").each(function(){var t=$(this).html(),n=e.getParam("twPreCodeManagerSettings",{}).protectSquareBracketXter||"*";$(this).html(t.replace(/(?:\[\[)/g,"["+n+"["))})})}),showDownInnerInitRTE=function(e){var t={},n=$.extend({},t,e);return n},tinymce.PluginManager.add("twShowdown",function(e){function t(n){if(1==n)popCodeShowdown(e.id);else if(0==n){var o=e.getParam("twShowdownSettings",{}).twInlineWidth||"auto",a=e.getParam("twShowdownSettings",{}).twInlineHeight||250;if(e.getParam("inline"))var i=e.id;else var i=e.getContainer().id;$("#"+i).before("<div style=dispaly:none; class='coderSNparent "+e.id+"' data-origin="+e.id+"><span type=button onclick='killCodeShowdown(\""+e.id+"\",1)' class='mce-close-button mce-reset'  title='Close this Showdown'><i class='mce-ico mce-i-remove'></i></span><div class='showdown codeT' id='codeT"+e.id+"' data-height="+a+" data-width="+o+"></div>");var r=$("#"+i).width(),c=a-5;$("#codeT"+e.id).css({"max-width":r,height:c}),$(".coderSNparent."+e.id).css({"max-width":r,height:a}).fadeIn(),transformMarks(e,e.id),$(window).resize(function(){$(".coderSNparent."+e.id).length&&$(".codeT."+e.id+", .coderSNparent."+e.id).css("max-width",r)}),e.on("change InsertContent",function(){transformMarks(e,e.id)}),0!==e.getParam("twShowdownSettings",{}).twPopped&&popCodeShowdown(e.id)}else $(".coderSNparent."+e.id).length?popCodeShowdown(e.id):t(0)}function n(n){var o='<style id="mainCSSshowDown">.x-window-body{overflow-x:hidden!important;}.codeT,.coderSNparent{position:relative; margin:auto}.mce-popCode .mce-title{text-align:center;} .mce-popCode .mce-close-button{display:none;}.coderSNparent > .mce-close-button{position:absolute;top:-22px;right:0;cursor: pointer;background: #FFF;margin: 0 19px -4px 0;text-align: center;border-radius: 5px 5px 0 0;padding: 2px;box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4);}.mce-popShowdown,.mce-popShowdown .mce-container-body{width:inherit!important}.coderSNparent .showdown{white-space: normal !important;word-wrap: break-word;box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4); width:inherit;height:inherit;overflow:auto;padding:10px ;margin:auto}.mce-popCode .showdown{box-shadow:none;}.coderSNparent > .mce-close-button > .mce-ico{font-size:15px; color:#000;}</style>';if($("#mainCSSshowDown").length||$("head").append(o),"undefined"==typeof showdown){{var a=e.getParam("twShowdownSettings",{}).twShowdownCDNbase||"https://cdnjs.cloudflare.com/ajax/libs/showdown/1.4.1/",i=e.getParam("twShowdownSettings",{}).twMathJaxURL||"https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML",r=new tinymce.dom.ScriptLoader;new tinymce.dom.ScriptLoader}r.add(a+"showdown.min.js"),"undefined"==typeof MathJax&&e.getParam("twShowdownSettings",{}).twEnableMathJax!==!1&&r.add(i),r.loadQueue(function(){setTimeout(function(){t(n)},500)})}else t(n)}$("#"+e.id);e.on("focus change",function(){e.save()}),e.addButton("preview",{type:"button",icon:"preview",tooltip:"Markdown/MathJax Preview",onclick:function(){$(".mce-popShowdown.mce-"+e.id).length||n()}}),e.addMenuItem("preview",{icon:"preview",text:"Markdown/MathJax Preview",onclick:function(){$(".mce-popShowdown.mce-"+e.id).length||n()}})});var miniCSS='<style id="modxMagicHoverLinkCSS">.moce-useMODX button{background-image: linear-gradient(to right,#3f4850 0,#365462 46%,#3e5554 60%,#42554d 68%,#573d4e 100%); box-shadow: 0 2px 0 #E4E4E4; color:white!important;}#themChecks{display:none;position:absolute;top:17px;left:60px}.mce-themChecks{display:inline;margin-left:8px !important;}.mce-themChecksMORE,.mce-themChecksScMORE{height: 23px !important;width: 20px!important;background: none!important;box-shadow: none!important;border: 0!important;margin-left: 0 !important;text-align: center!important;}.mce-themChecksMORE button,.mce-themChecksScMORE button{padding:0!important;}.twEasyHover{padding-top:20px!important;padding-bottom:20px!important;}.twEasyHover,.twEasyHover *{cursor:default!important;}.twEasyHover:before{content:"";position:absolute;width:100%;height:100%;}.mce-themChecksIMAGE{position:absolute!important;top:12px!important;z-index:2;}</style>';$("#modxMagicHoverLinkCSS").length||$("head").append(miniCSS),tinyMODXselectedID=!1,$(document).on("mouseenter","[ext\\:tree-node-id]",function(){if($(".mce-useMODX").hasClass("useMODXyes")){tinyMODXselectedTEXT=$(this).find("a > span").clone().children().remove().end().text().trim(),tinyMODXselectedTITLE=$(this).find("a > span").clone().html($(this).find("a > span").attr("qtip")).text().trim();var e=$("[class^=mce-themChecksMORE].mce-active").attr("scheme")?"? &scheme=`"+$("[class^=mce-themChecksMORE].mce-active").attr("scheme")+"`":"";tinyMODXselectedID=$(this).find("a > span > span").text().replace(/\D/g,""),tinyMODXselectedID&&tinyMODXselectedTEXT&&(("true"==$(".mce-themChecksURL").attr("aria-checked")||"true"==$(".mce-themChecksTXT").attr("aria-checked")||"true"==$(".mce-themChecksTITLE").attr("aria-checked"))&&tinymce.activeEditor.getParam("modxMagicHoverLinkSettings",{}).addClassToTree!==!1&&$(this).addClass("twEasyHover"),"true"==$(".mce-themChecksURL").attr("aria-checked")&&$(".mce-modxUrl input.mce-textbox").val("[[~"+tinyMODXselectedID+e+"]]"),"true"==$(".mce-themChecksTXT").attr("aria-checked")&&$(".mce-tinyMODXselected").val(tinyMODXselectedTEXT),"true"==$(".mce-themChecksTITLE").attr("aria-checked")&&$(".mce-modxTitle").val($(".mce-themChecksMOREdesc").hasClass("mce-active")?tinyMODXselectedTITLE:tinyMODXselectedTEXT))}}).on("mouseleave","[ext\\:tree-node-id]",function(){$(".twEasyHover").removeClass("twEasyHover")}),$(document).on("mouseenter","[class^=mce-tinyMODXLinkList]",function(){if(tinyMODXselectedID=$(this).attr("class"),$(".mce-useMODX").hasClass("useMODXyes")&&tinyMODXselectedID.indexOf("[[~")>-1){tinyMODXselectedTEXT=$(this).find("span.mce-text").text().trim(),tinyMODXselectedTITLE=$(this).find("span.mce-text").text().trim();var e=$("[class^=mce-themChecksMORE].mce-active").attr("scheme")?"? &scheme=`"+$("[class^=mce-themChecksMORE].mce-active").attr("scheme")+"`":"";tinyMODXselectedID=tinyMODXselectedID.replace(/\D/g,""),tinyMODXselectedID&&tinyMODXselectedTEXT&&($(".mce-themChecksURL:visible").length&&"true"==$(".mce-themChecksURL").attr("aria-checked")&&$(".mce-modxUrl input.mce-textbox").val("[[~"+tinyMODXselectedID+e+"]]"),"true"==$(".mce-themChecksTXT").attr("aria-checked")&&$(".mce-tinyMODXselected").val(tinyMODXselectedTEXT),"true"==$(".mce-themChecksTITLE").attr("aria-checked")&&$(".mce-modxTitle").val($(".mce-themChecksMOREdesc").hasClass("mce-active")?tinyMODXselectedTITLE:tinyMODXselectedTEXT))}}),$(document).on("mouseenter","div.section > p.x-combo-list-item > a",function(){if($(".mce-useMODX").hasClass("useMODXyes")){tinyMODXselectedTEXT=$(this).clone().children().remove().end().text().trim(),tinyMODXselectedTITLE=$(this).parent().next("ol").text().trim()||$(this).children("em").text(),tinyMODXselectedID=$(this).attr("href"),tinyMODXselectedID=tinyMODXselectedID.split("resource/update&id=");var e=$("[class^=mce-themChecksMORE].mce-active").attr("scheme")?"? &scheme=`"+$("[class^=mce-themChecksMORE].mce-active").attr("scheme")+"`":"";tinyMODXselectedID=tinyMODXselectedID[1],tinyMODXselectedID&&tinyMODXselectedTEXT&&("true"==$(".mce-themChecksURL").attr("aria-checked")&&$(".mce-modxUrl input.mce-textbox").val("[[~"+tinyMODXselectedID+e+"]]"),"true"==$(".mce-themChecksTXT").attr("aria-checked")&&$(".mce-tinyMODXselected").val(tinyMODXselectedTEXT),"true"==$(".mce-themChecksTITLE").attr("aria-checked")&&$(".mce-modxTitle").val($(".mce-themChecksMOREdesc").hasClass("mce-active")?tinyMODXselectedTITLE:tinyMODXselectedTEXT))}}),tinymce.PluginManager.add("modxMagicHoverLink",function(e){function t(t){return function(){var n=e.settings.link_list;"string"==typeof n?tinymce.util.XHR.send({url:n,success:function(e){t(tinymce.util.JSON.parse(e))}}):"function"==typeof n?n(t):t(n)}}function n(e,t,n){function o(e,n){return n=n||[],tinymce.each(e,function(e){var a={text:e.text||e.title};e.menu?(a.menu=o(e.menu),a.classes="tinyMODXLinkList"+e.value):(a.value=e.value,a.classes="tinyMODXLinkList"+e.value,t&&t(a)),n.push(a)}),n}return o(e,n||[])}function o(t){function o(e){var t=m.find("#text");(!t.value()||e.lastControl&&t.value()==e.lastControl.text())&&t.value(e.control.text()),m.find("#href").value(e.control.value())}function a(t){var n=[];return tinymce.each(e.dom.select("a:not([href])"),function(e){var o=e.name||e.id;o&&n.push({text:o,value:"#"+o,selected:-1!=t.indexOf("#"+o)})}),n.length?(n.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:n,onselect:o}):void 0}function i(){!l&&0===C.text.length&&p&&this.parent().parent().find("#text")[0].value(this.value())}function r(t){var n=t.meta||{};g&&g.value(e.convertURL(this.value(),"href")),tinymce.each(t.meta,function(e,t){m.find("#"+t).value(e)}),n.text||i.call(this)}function c(e){var t=M.getContent();if(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1==t.indexOf("href=")))return!1;if(e){var n,o=e.childNodes;if(0===o.length)return!1;for(n=o.length-1;n>=0;n--)if(3!=o[n].nodeType)return!1}return!0}if($(".mce-useMODX").length)e.windowManager.alert("modxMagicHoverLink does not allow multiple instances");
else{var d,s,l,m,p,u,g,h,w,x,b,f,C={},M=e.selection,v=e.dom;if(d=M.getNode(),s=v.getParent(d,"a[href]"),p=c(),C.text=l=s?s.innerText||s.textContent:M.getContent({format:"text"}),C.href=s?v.getAttrib(s,"href"):"",s?C.target=v.getAttrib(s,"target"):e.settings.default_link_target&&(C.target=e.settings.default_link_target),(f=v.getAttrib(s,"rel"))&&(C.rel=f),(f=v.getAttrib(s,"class"))&&(C["class"]=f),(f=v.getAttrib(s,"title"))&&(C.title=f),p){if(e.getParam("twExoticMarkdownEditor",!1))var y="Text",k="Link Text or Image Description (ALT)";u={name:"text",classes:"tinyMODXselected",type:"textbox",size:40,tooltip:k?k:"",label:y?y:"Text to display",onchange:function(){C.text=this.value()}}}if(t&&(g={type:"listbox",label:"Link list",classes:"tinyMODXLinkList",values:n(t,function(t){-1==t.value.indexOf("[[~")&&(t.value=e.convertURL(t.value||t.url,"href"))},[{text:"None",value:""}]),onselect:o,value:e.convertURL(C.href,"href"),onPostRender:function(){g=this}}),e.settings.target_list===!1||e.getParam("twExoticMarkdownEditor",!1)||(e.settings.target_list||(e.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),w={name:"target",type:"listbox",label:"Target",values:n(e.settings.target_list)}),e.settings.rel_list&&!e.getParam("twExoticMarkdownEditor",!1)&&(h={name:"rel",type:"listbox",label:"Rel",values:n(e.settings.rel_list)}),e.settings.link_class_list&&!e.getParam("twExoticMarkdownEditor",!1)&&(x={name:"class",type:"listbox",label:"Class",values:n(e.settings.link_class_list,function(t){t.value&&(t.textStyle=function(){return e.formatter.getCssText({inline:"a",classes:[t.value]})})})}),e.settings.link_title!==!1&&(b={name:"title",type:"textbox",label:"Title",classes:"modxTitle",value:C.title}),e.getParam("twExoticMarkdownEditor",!1))var y="Insert Link / Image";m=e.windowManager.open({title:y?y:"Insert Link",data:C,minWdth:450,onPostRender:function(){var t=$(".mce-foot > .mce-container-body.mce-abs-layout").attr("id");$(".mce-foot > .mce-container-body.mce-abs-layout").append("<div id='themChecks'></div>"),tinymce.ui.Factory.create({type:"button",icon:"fullpage",tooltip:"Toggle. HOVER over any Resource in Resource Tree, Search Result Tree or Link List.",classes:"useMODX",style:"position:absolute;top:10px;left:8px;",onPostRender:function(){$(".mce-useMODX").on("click",function(){$("#modx-leftbar").length||$(".mce-tinyMODXLinkList").length?$(this).hasClass("useMODXyes")?($(this).removeClass("useMODXyes"),$("#themChecks").fadeOut(),$("#modx-leftbar").length&&$("#mce-modal-block:hidden").length&&$("#mce-modal-block").show()):($(this).addClass("useMODXyes"),$("#themChecks").fadeIn(),$("#modx-leftbar").length&&$("#mce-modal-block:visible").length&&$("#mce-modal-block").fadeOut()):e.windowManager.alert("Required: MODX Resource Tree or Link List")})}}).renderTo(document.getElementById(t)),tinymce.ui.Factory.create({type:"checkbox",tooltip:"Autofill URL? + scheme",checked:!0,classes:"themChecks themChecksURL",text:"URL"}).renderTo(document.getElementById("themChecks")),tinymce.ui.Factory.create({type:"menubutton",tooltip:"Scheme Options",classes:"themChecks themChecksScMORE",menu:[{text:"Relative",classes:"themChecksMORErel",onclick:function(){$(".mce-themChecksMORErel").parent().children().removeClass("mce-active"),$(".mce-themChecksMORErel").addClass("mce-active")}},{text:"Full",classes:"themChecksMOREfull",onclick:function(){$(".mce-themChecksMOREfull").parent().children().removeClass("mce-active"),$(".mce-themChecksMOREfull").addClass("mce-active").attr("scheme","full")}},{text:"Absolute",classes:"themChecksMOREabs",onclick:function(){$(".mce-themChecksMOREabs").parent().children().removeClass("mce-active"),$(".mce-themChecksMOREabs").addClass("mce-active").attr("scheme","abs")}},{text:"HTTP",classes:"themChecksMOREhttp",onclick:function(){$(".mce-themChecksMOREhttp").parent().children().removeClass("mce-active"),$(".mce-themChecksMOREhttp").addClass("mce-active").attr("scheme","http")}},{text:"HTTPS",classes:"themChecksMOREhttps",onclick:function(){$(".mce-themChecksMOREhttps").parent().children().removeClass("mce-active"),$(".mce-themChecksMOREhttps").addClass("mce-active").attr("scheme","https")}}]}).renderTo(document.getElementById("themChecks")),$(".mce-tinyMODXselected").length&&tinymce.ui.Factory.create({type:"checkbox",tooltip:"Autofill Text To Display?",classes:"themChecks themChecksTXT",text:"Text"}).renderTo(document.getElementById("themChecks")),tinymce.ui.Factory.create({type:"checkbox",tooltip:"Autofill Title?",classes:"themChecks themChecksTITLE",text:"Title"}).renderTo(document.getElementById("themChecks")),tinymce.ui.Factory.create({type:"menubutton",tooltip:"Title Options",classes:"themChecks themChecksMORE",menu:[{text:"Use Resource Description",classes:"themChecksMOREdesc",onclick:function(){$("#modx-leftbar").length?$(".mce-themChecksMOREdesc").hasClass("mce-active")?$(".mce-themChecksMOREdesc").removeClass("mce-active"):$(".mce-themChecksMOREdesc").addClass("mce-active"):e.windowManager.alert("Required: MODX Resource Tree")}}]}).renderTo(document.getElementById("themChecks")),e.getParam("twExoticMarkdownEditor",!1)&&tinymce.ui.Factory.create({type:"checkbox",tooltip:"Insert image instead",classes:"themChecks themChecksIMAGE"}).renderTo(document.getElementById($(".mce-title").attr("id")))},body:[{name:"href",type:"filepicker",filetype:"file image media",size:40,autofocus:!0,label:"Url",classes:"modxUrl",onchange:r,onkeyup:i},u,b,a(C.href),g,h,w,x],onSubmit:function(t){function n(t,n){var o=e.selection.getRng();tinymce.util.Delay.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(o),n(t)})})}function o(){var t={href:a,target:C.target?C.target:null,rel:C.rel?C.rel:null,"class":C["class"]?C["class"]:null,title:C.title?C.title:null};if(s)e.focus(),p&&C.text!=l&&("innerText"in s?s.innerText=C.text:s.textContent=C.text),v.setAttribs(s,t),M.select(s),e.undoManager.add();else if(p)if(e.getParam("twExoticMarkdownEditor",!1)){var n="";if("true"==$(".mce-themChecksIMAGE").attr("aria-checked"))var n="!";var o=t.title?' "'+t.title+'"':"";e.insertContent(n+"["+v.encode(C.text).trim()+"]("+t.href+o+") ")}else e.insertContent(v.createHTML("a",t,v.encode(C.text)));else e.execCommand("mceInsertLink",!1,t)}var a;return C=tinymce.extend(C,t.data),(a=C.href)?a.indexOf("@")>0&&-1==a.indexOf("//")&&-1==a.indexOf("mailto:")?void n("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(e){e&&(a="mailto:"+a),o()}):e.settings.link_assume_external_targets&&!/^\w+:/i.test(a)||!e.settings.link_assume_external_targets&&/^\s*www[\.|\d\.]/i.test(a)?void n("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(e){e&&(a="http://"+a),o()}):void o():void e.execCommand("unlink")}})}}e.on("init change",function(){e.getParam("modxMagicHoverLinkSettings",{}).stripMODXurl;e.getParam("modxMagicHoverLinkSettings",{}).stripMODXurl!==!1&&$(e.getBody()).find("a").each(function(){var e=$(this).attr("href");e&&e.indexOf("[[~")>-1&&e.indexOf("]]")>-1&&(split1=e.split("[[~"),split2=split1[1].split("]]"),e="[[~"+split2[0]+"]]",$(this).attr({href:e,"data-mce-href":e}))})}),e.on("DblClick",function(t){e.getParam("tinymceBubbleBar",!1)||("IMG"==t.target.nodeName&&e.execCommand("mceImage",!0),"A"==t.target.nodeName&&e.execCommand("mceLink",!0))}),twExoticMarkdownEditorIcon="link",twExoticMarkdownEditorIText="Insert/edit link",e.getParam("twExoticMarkdownEditor",!1)&&(twExoticMarkdownEditorIcon="browse",twExoticMarkdownEditorIText="Markdown Link/Image"),e.addButton("link",{icon:twExoticMarkdownEditorIcon,tooltip:twExoticMarkdownEditorIText,shortcut:"Meta+K",onclick:t(o),stateSelector:"a[href]"}),e.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"}),e.addShortcut("Meta+K","",t(o)),e.addCommand("mceLink",t(o)),e.addCommand("modxMagicHoverLink",t(o)),this.showDialog=o,e.addMenuItem("link",{icon:twExoticMarkdownEditorIcon,text:twExoticMarkdownEditorIText,shortcut:"Meta+K",onclick:t(o),stateSelector:"a[href]",context:"insert",prependToContext:!0})});var mainExotic='<style id=mainExotic>.twExoticMarkdownEditor:before {display: block;content: "markdown";position: absolute;top: 2px;right: 5px;font-style: italic;font-size: 10px;background: #F2F2F2;padding: 1px 2px;border-radius: 4px;color: #2F4150;}.twExoticMarkdownEditor:hover:before{opacity:0.3;}</style>';tinymce.PluginManager.add("twExoticMarkdownEditor",function(e){e.on("BeforeExecCommand",function(e){return"twPreCodeManager"!=e.command&&"SelectAll"!=e.command&&"undo"!=e.command&&"redo"!=e.command&&"Undo"!=e.command&&"Redo"!=e.command&&"mceInsertContent"!=e.command&&"InsertLineBreak"!=e.command&&"Delete"!=e.command&&"mceSave"!=e.command?(e.preventDefault,!1):void 0}),e.on("BeforeSetContent",function(t){e.settings.forced_root_block="",e.settings.force_p_newlines=!1,e.settings.force_br_newlines=!0,e.settings.unMarkedContent=getMyFootMarks(t.content)}),e.on("LoadContent",function(){$(e.getBody()).hasClass(e.getParam("twExoticMarkdownEditorSettings",{}).skipClass)||e.setContent(e.settings.unMarkedContent,{format:"raw"}),e.getParam("twExoticMarkdownEditorSettings",{}).removeClasses&&$(e.getBody()).removeClass(e.getParam("twExoticMarkdownEditorSettings",{}).removeClasses)}),e.on("init",function(){e.settings.twExoticMarkdownEditor=!0,e.getParam("twExoticMarkdownEditorSettings",{}).addAttr!==!1&&$(e.getBody()).attr("markdown",1),e.getParam("twExoticMarkdownEditorSettings",{}).addClass!==!1&&($(e.getBody()).addClass("twExoticMarkdownEditor"),$(e.getBody()).parents("html").find("head #mainExotic").length||$(e.getBody()).parents("html").find("head").append(mainExotic))}),e.on("SaveContent",function(t){e.isHidden()&&e.windowManager.alert("Please do not save while in hidden mode",function(){e.show()}),t.content=saveMyFootMarks(t.content)}),e.on("PastePreProcess",function(e){var t=$("<div/>").html(e.content.replace(/  /g," &nbsp;").replace(/(?:\r\n|\r|\n)/g,"<br>"));t.children().contents().unwrap(),e.content=t.html()}),e.shortcuts.add("ctrl+b","",function(){makeMyFootMarks(e,"**","BOLD","** ")}),e.shortcuts.add("meta+b","",function(){makeMyFootMarks(e,"**","BOLD","** ")}),e.shortcuts.add("ctrl+i","",function(){makeMyFootMarks(e,"_","ITALIC","_ ")}),e.shortcuts.add("meta+i","",function(){makeMyFootMarks(e,"_","ITALIC","_ ")}),e.addButton("boldMD",{icon:"bold",tooltip:"Insert/Make Bold (ctrl+b)",onclick:function(){makeMyFootMarks(e,"**","BOLD","** ")}}),e.addButton("italicMD",{icon:"italic",tooltip:"Insert/Make Italic (ctrl+i)",onclick:function(){makeMyFootMarks(e,"_","ITALIC","_ ")}}),e.addButton("linkMD",{icon:"link",tooltip:"Insert/Make Link",onclick:function(){makeMyFootMarks(e,"[","LINK_TEXT","](http://link.com) ")}}),e.addButton("imageMD",{icon:"image",tooltip:"Insert/Make Image",onclick:function(){makeMyFootMarks(e,"![","IMAGE_ALT",'](image.jpg "TOOL_TIP") ')}}),e.addButton("blockquoteMD",{icon:"blockquote",tooltip:"Insert/Make Blockquote",onclick:function(){makeMyFootMarks(e,"<br>>","QUOTE","<br><br>")}}),e.addButton("codeMD",{icon:"code",tooltip:"Insert/Make Pre/Code",onclick:function(){makeMyFootMarks(e,"<br>```language-<br>","CODE","<br>```<br><br>")}}),e.addButton("numlistMD",{icon:"numlist",tooltip:"Insert/Make Number List",onclick:function(){makeMyFootMarks(e,"<br>1. ","ITEM_ONE","<br>2. ITEM_TWO<br>3. ITEM_THREE<br><br>")}}),e.addButton("bullistMD",{icon:"bullist",tooltip:"Insert/Make Bullet List",onclick:function(){makeMyFootMarks(e,"<br>+ ","ITEM_ONE","<br>+ ITEM_TWO<br><br>+ ITEM_THREE<br><br>")}}),e.addButton("tableMD",{icon:"table",tooltip:"Generate Markdown Tables (external link)",onclick:function(){window.open("http://www.tablesgenerator.com/markdown_tables")}}),e.addMenuItem("boldMD",{icon:"bold",text:"Insert/Make Bold",onclick:function(){makeMyFootMarks(e,"**","BOLD","** ")}}),e.addMenuItem("italicMD",{icon:"italic",text:"Insert/Make Italic",onclick:function(){makeMyFootMarks(e,"_","ITALIC","_ ")}}),e.addMenuItem("linkMD",{icon:"link",text:"Insert/Make Link",onclick:function(){makeMyFootMarks(e,"[","LINK_TEXT","](http://link.com) ")}}),e.addMenuItem("imageMD",{icon:"image",text:"Insert/Make Image",onclick:function(){makeMyFootMarks(e,"![","IMAGE_ALT",'](image.jpg "TOOL_TIP") ')}}),e.addMenuItem("blockquoteMD",{icon:"blockquote",text:"Insert/Make Blockquote",onclick:function(){makeMyFootMarks(e,"<br>>","QUOTE","<br><br>")}}),e.addMenuItem("codeMD",{icon:"code",text:"Insert/Make Pre/Code",onclick:function(){makeMyFootMarks(e,"<br>```language-<br>","CODE","<br>```<br><br>")}}),e.addMenuItem("numlistMD",{icon:"numlist",text:"Insert/Make Number List",onclick:function(){makeMyFootMarks(e,"<br>1. ","ITEM_ONE","<br>2. ITEM_TWO<br>3. ITEM_THREE<br><br>")}}),e.addMenuItem("bullistMD",{icon:"bullist",text:"Insert/Make Bullet List",onclick:function(){makeMyFootMarks(e,"<br>+ ","ITEM_ONE","<br>+ ITEM_TWO<br><br>+ ITEM_THREE<br><br>")}}),e.addMenuItem("tableMD",{icon:"table",text:"Tables (external link)",onclick:function(){window.open("http://www.tablesgenerator.com/markdown_tables")}})}),codeMirrorInnerInitRTE=function(e){var t={mode:"htmlmixed",theme:"",indentOnInit:!0,lineNumbers:!0,lineWrapping:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],indentUnit:1,tabSize:1,matchBrackets:!0,styleActiveLine:!0,autoCloseTags:!0,showTrailingSpace:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-F":"findPersistent",F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)},"Ctrl-Q":function(e){e.foldCode(e.getCursor())}}},n=$.extend({},t,e);return n},tinymce.PluginManager.add("twCodeMirror",function(e){function t(n){if(1==n)popCode(e.id);else if(0==n){var o=e.getParam("twCodeMirrorSettings",{}).twInlineWidth||"auto",a=e.getParam("twCodeMirrorSettings",{}).twInlineHeight||250;if(e.getParam("inline"))var i=e.id;else var i=e.getContainer().id;if($("#"+i).before("<div style=dispaly:none; class='coder "+e.id+"' data-origin="+e.id+"><span type=button onclick='killCode(\""+e.id+"\",1)' class='mce-close-button mce-reset'  title='Close this CodeMirror'><i class='mce-ico mce-i-remove'></i></span><textarea class='codeT' id='codeT"+e.id+"'>"+e.getContent()+"</textarea>"),$(".coder."+e.id).css({width:o,height:a}).fadeIn(),window["codeT"+e.id]=CodeMirror.fromTextArea(document.getElementById("codeT"+e.id),codeMirrorInnerInitRTE(e.getParam("twCodeMirrorSettings",{}))),e.getParam("twCodeMirrorSettings",{}).twFontSize)var r=e.getParam("twCodeMirrorSettings").twFontSize;else var r=15;$(".coder."+e.id+" .CodeMirror").css("font-size",r),window["codeT"+e.id].refresh(),"undefined"!=typeof emmetCodeMirror&&emmetCodeMirror(window["codeT"+e.id]),codeMirrorSetContentsilent=!1,window["codeT"+e.id].on("keyup",function(){codeMirrorSetContentsilent||e.setContent(window["codeT"+e.id].getValue())}),e.on("keyup",function(){codeMirrorSetContentsilent=!0,window["codeT"+e.id].getDoc().setValue(e.getContent()),codeMirrorSetContentsilent=!1}),0!==e.getParam("twCodeMirrorSettings",{}).twPopped&&popCode(e.id)}else $(".coder."+e.id).length?popCode(e.id):t(0)}function n(n){var o='<style id="mainCSScodeMIrror">.x-window-body{overflow-x:hidden!important;}.codeT,.coder{position:relative}.mce-popCode .mce-title{text-align:center;} .mce-popCode .mce-close-button{display:none;}.CodeMirror{text-align:left!important}.cm-trailingspace{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAYAAAB/qH1jAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QUXCToH00Y1UgAAACFJREFUCNdjPMDBUc/AwNDAAAFMTAwMDA0OP34wQgX/AQBYgwYEx4f9lQAAAABJRU5ErkJggg==);background-position:bottom left;background-repeat:repeat-x}.coder > .mce-close-button{position:absolute;top:-18px;right:0;cursor: pointer;background: #FFF;margin: 0 19px -4px 0;text-align: center;border-radius: 5px 5px 0 0;padding: 2px;box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4);}.mce-popCodeMirror,.mce-popCodeMirror .mce-container-body{width:inherit!important}.coder .CodeMirror{box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4); width:inherit;height:inherit;}.mce-popCode .CodeMirror{box-shadow:none;width:98.8%!important;}.coder > .mce-close-button > .mce-ico{font-size:15px; color:#000;}</style>';if($("#mainCSScodeMIrror").length||$("head").append(o),"undefined"==typeof CodeMirror){var a=e.getParam("twCodeMirrorSettings",{}).twCodeMirrorCDNbase||"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.14.2/",i=new tinymce.dom.ScriptLoader,r=new tinymce.dom.ScriptLoader;tinymce.DOM.loadCSS(a+"codemirror.min.css"),tinymce.DOM.loadCSS(a+"addon/dialog/dialog.css"),tinymce.DOM.loadCSS(a+"addon/search/matchesonscrollbar.css"),tinymce.DOM.loadCSS(a+"addon/display/fullscreen.css"),tinymce.DOM.loadCSS(a+"addon/fold/foldgutter.css"),e.getParam("twCodeMirrorSettings",{}).theme&&tinymce.DOM.loadCSS(a+"theme/"+e.getParam("twCodeMirrorSettings").theme+".css"),i.add(a+"codemirror.min.js"),i.loadQueue(function(){"undefined"==typeof emmetCodeMirror&&e.getParam("twCodeMirrorSettings",{}).twEmmetUrl&&r.add(e.getParam("twCodeMirrorSettings").twEmmetUrl),r.add(a+"addon/wrap/hardwrap.min.js"),r.add(a+"addon/selection/active-line.min.js"),r.add(a+"addon/search/searchcursor.min.js"),r.add(a+"addon/scroll/annotatescrollbar.js"),r.add(a+"addon/search/matchesonscrollbar.js"),r.add(a+"addon/search/jump-to-line.min.js"),r.add(a+"addon/search/search.min.js"),r.add(a+"addon/dialog/dialog.min.js"),r.add(a+"addon/hint/show-hint.min.js"),r.add(a+"addon/hint/html-hint.min.js"),r.add(a+"addon/hint/xml-hint.min.js"),r.add(a+"addon/edit/closetag.min.js"),r.add(a+"addon/edit/trailingspace.min.js"),r.add(a+"addon/display/fullscreen.js"),r.add(a+"addon/fold/foldcode.js"),r.add(a+"addon/fold/foldgutter.js"),r.add(a+"addon/fold/brace-fold.js"),r.add(a+"addon/fold/xml-fold.js"),r.add(a+"addon/fold/comment-fold.js"),r.add(a+"addon/edit/matchbrackets.min.js"),r.add(a+"mode/htmlmixed/htmlmixed.min.js"),r.add(a+"mode/javascript/javascript.min.js"),r.add(a+"mode/xml/xml.min.js"),r.add(a+"mode/css/css.min.js"),r.loadQueue(function(){setTimeout(function(){t(n)},500)})})}else t(n)}$("#"+e.id);e.addButton("code",{type:"button",classes:"twCoderM",icon:"code",tooltip:"CodeMirror",onclick:function(){$(".mce-popCodeMirror.mce-"+e.id).length||n()}}),e.addMenuItem("code",{icon:"code",text:"CodeMirror",onclick:function(){$(".mce-popCodeMirror.mce-"+e.id).length||n()}})}),aceInnerInitRTE=function(e){var t={mode:"ace/mode/html",wrap:"free",displayIndentGuides:!0,scrollPastEnd:!1,showPrintMargin:!1,fontSize:15,tabSize:2},n=$.extend({},t,e);return n},tinymce.PluginManager.add("twAceEditor",function(e){function t(n){if(1==n)popCodeAce(e.id);else if(0==n){var o=e.getParam("twAceEditorSettings",{}).twInlineWidth||"auto",a=e.getParam("twAceEditorSettings",{}).twInlineHeight||250;if(e.getParam("inline"))var i=e.id;else var i=e.getContainer().id;$("#"+i).before("<div style=dispaly:none; class='coder "+e.id+"' data-origin="+e.id+"><span type=button onclick='killCodeAce(\""+e.id+"\",1)' class='mce-close-button mce-reset'  title='Close this Ace'><i class='mce-ico mce-i-remove'></i></span><textarea class='codeT' id='codeT"+e.id+"'>"+e.getContent()+"</textarea>"),$(".coder."+e.id).css({width:o,height:a}).fadeIn(),window["codeT"+e.id]=ace.edit("codeT"+e.id),window["codeT"+e.id].$blockScrolling=1/0,("undefined"!=typeof emmetForAceIsLoaded||e.getParam("twAceEditorSettings",{}).enableEmmet&&e.getParam("twAceEditorSettings",{}).twEmmetUrl)&&window["codeT"+e.id].setOption("enableEmmet",!0),window["codeT"+e.id].setOptions(aceInnerInitRTE(e.getParam("twAceEditorSettings",{}))),window["codeT"+e.id].resize(),aceSetContentsilent=!1,window["codeT"+e.id].on("change",function(){aceSetContentsilent||e.setContent(window["codeT"+e.id].getValue())}),e.on("keyup ",function(){aceSetContentsilent=!0,window["codeT"+e.id].setValue(e.getContent()),aceSetContentsilent=!1}),0!==e.getParam("twAceEditorSettings",{}).twPopped&&popCodeAce(e.id)}else $(".coder."+e.id).length?popCodeAce(e.id):t(0)}function n(n){var o='<style id="mainCSSAceEditor">.x-window-body{overflow-x:hidden!important;}.codeT,.coder{position:relative}.codeT{width:100%;resize:vertical;color:#000;min-height:300px;margin:0 auto}.mce-popCode .mce-title{text-align:center;} .mce-popCode .mce-close-button{display:none;}.ace_editor{text-align:left!important}.mce-popCode .ace_editor{height:inherit;width:99.5%!important;}.coder .ace_editor{height:inherit;width:inherit;}.mce-popAceEditor,.mce-popAceEditor .mce-container-body{width:inherit!important}.coder > .mce-close-button{position:absolute;top:-18px;right:0;cursor: pointer;background: #FFF;margin: 0 19px -4px 0;text-align: center;border-radius: 5px 5px 0 0;padding: 2px;box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4);}.coder .ace_editor{box-shadow: 0px 0px 1px 1px rgba(0, 0, 0, 0.4)}.mce-popCode .ace_editor{box-shadow:none;}.coder > .mce-close-button > .mce-ico{font-size:15px; color:#000;}</style>';if($("#mainCSSAceEditor").length||0===e.getParam("twAceEditorSettings",{}).twLoadCSS||$("head").append(o),"undefined"==typeof ace){var a=e.getParam("twAceEditorSettings",{}).twAceEditorCDNbase||"https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/",i=new tinymce.dom.ScriptLoader;i.add(a+"ace.js"),"undefined"==typeof emmetForAceIsLoaded&&e.getParam("twAceEditorSettings",{}).twEmmetUrl&&(i.add(e.getParam("twAceEditorSettings",{}).twEmmetUrl),i.add(a+"ext-emmet.js")),i.loadQueue(function(){setTimeout(function(){t(n)},500)})}else t(n)}$("#"+e.id);e.addButton("code",{type:"button",classes:"twAceE",icon:"code",tooltip:"Ace Editor",onclick:function(){$(".mce-popAceEditor.mce-"+e.id).length||n()}}),e.addMenuItem("code",{icon:"code",text:"Ace Editor",onclick:function(){$(".mce-popAceEditor.mce-"+e.id).length||n()}})});